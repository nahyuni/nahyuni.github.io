<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title></title>
  
  <subtitle>나 혀니의 블로그 입니다.~~</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2023-06-12T12:36:14.534Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>nahyuni21(Park.S.H)</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>RTP,RTCP,RTSP 개요</title>
    <link href="http://yoursite.com/2023/06/12/dev-rtp/"/>
    <id>http://yoursite.com/2023/06/12/dev-rtp/</id>
    <published>2023-06-12T12:31:00.000Z</published>
    <updated>2023-06-12T12:36:14.534Z</updated>
    
    <content type="html"><![CDATA[<h3 id="RTP-Real-Time-Transport-Protocol"><a href="#RTP-Real-Time-Transport-Protocol" class="headerlink" title="- RTP(Real Time Transport Protocol)"></a>- RTP(Real Time Transport Protocol)</h3><ol><li>Viedio/Audio <strong>데이터</strong> 전송을 위한 프로토콜.</li><li>RTP는 불규칙하게 수신되는 데이터의 순서를 정렬하기 위해 타임스탬프 방식을 사용</li><li>프로토콜 내부에 위치하는 버퍼의 크기를 각 응용 프로그램마다 별도로 관리하기가 용이함.</li><li>RTP는 유니 캐스팅뿐만 아니라 멀티캐스팅도 지원한다.</li><li>서버에서 클라이언트로 단방향 전송.</li><li>해더 마다 코덱이 들어가므로 네트워크 상황에 따라 코덱을 바꿀수 있음.</li><li>UDP/IP 패킷 전송.</li><li>실시간 환경에서는 수신 프로세스에 도착하는 전송 간격이 그대로 유지 되는 것이 중요하므로 버퍼라는 도구를 사용</li><li>가변적인 간격으로 도착하는 데이터를 즉시 수신사에 보내지 않고 지연 버퍼를 통해 다시 일정한 간격으로 보정을 하는 역할을 수행한다.</li></ol><p><img src=":/ed0ad510d9b14fff8bd168b8d9d0f260" alt="스크린샷_2018-07-15_오후_9.36.52.png"></p><h4 id="RTP-릴레이-기능"><a href="#RTP-릴레이-기능" class="headerlink" title="RTP 릴레이 기능"></a>RTP 릴레이 기능</h4><ol><li>고속 네트워크와 저속 네트워크 모두를 만족시키기 위해 데이터 중계 호스트를 규정</li></ol><h5 id="믹서-데이터-합성기"><a href="#믹서-데이터-합성기" class="headerlink" title="믹서(데이터 합성기)"></a>믹서(데이터 합성기)</h5><ol><li>네트워크 대역이 충분하지 않는 경우 개별적으로 데이터를 송신하면 네트워크 대역이 범람하여 부족 현상이 생길 가능성이 있음.</li><li>여러 송신 프로세스의 데이터그램을 적절히 조합하여 새로운 데이터그램을 생성한다.<br>ex) 영상과 음성을 믹싱하여 새로운 동영상을 만드는것</li></ol><h5 id="트랜슬레이터-속도-변환기"><a href="#트랜슬레이터-속도-변환기" class="headerlink" title="트랜슬레이터(속도 변환기)"></a>트랜슬레이터(속도 변환기)</h5><ol><li>수신자 환경에 맞게 바꾸어 주는 것을 의미한다.</li></ol><h4 id="세션-Session"><a href="#세션-Session" class="headerlink" title="세션(Session)"></a>세션(Session)</h4><ol><li><p>RTP를 이용하여 통신하는 호스트 그룹을 세션이라는 개념을 이용하여 식별</p><ul><li>예를 들어  A와 B가 서로 RTP를 이용해 통신을 한다면, 서로를 연결하는<br>하나의 session이 만들어짐. 이때에 C가  A와 B 의 통신에 참여해도 session은 1개임.</li></ul></li><li><p>UDP와 IP를 이용할 경우 세션은 (수신처 IP + UDP 포트) 조합으로 식별함.</p></li></ol><h3 id="프로토콜"><a href="#프로토콜" class="headerlink" title="프로토콜"></a>프로토콜</h3><ol><li><p>UDP 를 이용함.(RTP + UDP + IP) -&gt; 재전송 패킷은 수신 단말이 재생 시점을 이미 지나가 버린 이후가 될 확률이 높아 패킷을 처리함.</p></li><li><p>오버해드(40Byte) - ethernet(18) + IP(20) + UDP(8) + RTP(12) + 10ms(160) - DSP칩 G.711 코덱 사용시 =&gt; 초당100개 전송<br>일반적으로 20ms 초당 50개 패킷 생성.</p></li><li><p>RTP 해더(12Byte)<br><img src=":/a37c79fa3b2e4d0ca31de4f8682b2039" alt="RTP_Header.png"></p><ul><li>용어 설명</li></ul><p>3.1.1 페이로드 타입(Payload Type) - 코덱의 유형(G.711, H264 엔코딩)<br>3.1.2 SSRC : 동기소스 식별자 미디어스트림의 소스 식별함. 1564169535 - 한 웹브라우저에서 2개 동영상 재생.<br>3.1.3 Sequence Number : RTP 패킷 단위로 순차적 할당되는 번호.</p></li></ol><h3 id="RTCP-Real-Time-Transport-Control-Protocol"><a href="#RTCP-Real-Time-Transport-Control-Protocol" class="headerlink" title="- RTCP(Real Time Transport Control Protocol)"></a>- RTCP(Real Time Transport Control Protocol)</h3><h4 id="배경"><a href="#배경" class="headerlink" title="배경"></a>배경</h4><ol><li>RTP는 데이터 전송만 하는 프로토콜로써 통신 상황을 전하는 체계가 없음.</li><li>네트워크가 혼잡할 경우 데이터 전송속도나 전송량 감소.</li><li>수신측에서 수신 속도가 전송속도보다 느린 경우 전송측에서 데이터 전송 속도 조절을 할 필요성 발생.</li></ol><h4 id="개요-및-특징"><a href="#개요-및-특징" class="headerlink" title="개요 및 특징"></a>개요 및 특징</h4><ol><li>RTP 데이터 전송 상태 감시, RTP 세션 제어 프로토콜.</li><li>양방향 통신.</li><li>주기적으로 송수신자가 리포트 패킷을 주고 받음.</li><li>RTP  짝수 포트, RTCP RTP 포트 + 1을 사용.</li><li>RTCP 메세지 종류</li></ol><p><img src=":/95b194cfefc64f6e910b14769c1a84e4" alt="1805_1.jpg"></p><p>ㅇ SR 또는 RS : Sender Report (송신자 보고)<br>     - 송신자 측에서 주기적인 품질정보 통계 데이터<br>        . 송신 패킷수 등</p><p>  ㅇ RR : Receiver Report (수신자 보고)<br>     - 수신자 측에서 주기적인 품질정보 통계 데이터<br>        . 패킷손실율, 누적손실패킷수 등</p><p>  ㅇ SDES : Source Description message<br>     - 소스가 자신의 정보를 주기적으로 알림<br>     - SSRC에 해당되는 사용자 이름, 전자우편 주소, 로그인 ID 등으로 송신자 설명</p><p>  ㅇ BYE : Bye message<br>     - 현재 세션에의 모든 참가자에게 종료될 것을 알림</p><p>  ㅇ APP : Application specfic RTCP<br>     - 어플레이션 상호 간에 정보를 전달하기 위해 사용</p><h3 id="RTSP-Real-Time-Streaming-Protocol"><a href="#RTSP-Real-Time-Streaming-Protocol" class="headerlink" title="- RTSP(Real Time Streaming Protocol)"></a>- RTSP(Real Time Streaming Protocol)</h3><ol><li><p>RTSP(RealTime Streaming Protocol)은  On Demand 형식으로 리얼타임 미디어 전송을 행하는 애플리케이션 계층의 프로토콜</p></li><li><p>RTSP는 인터넷 상에서 스트리밍 데이터를 제어하는 방법에 대한 표준안으로 스트리밍 기술이 사용하는 표준 프로토콜</p></li><li><p>기본포트 554</p></li></ol><p><img src=":/33962f927a0043bb88d2c069a134a748" alt="rtsp1.png"></p><ul><li><p>OPTIONS<br>OPTIONS 요청은 서버의 accept 타입을 반환합니다.</p></li><li><p>DESCRIBE<br>DESCRIBE 요청에는 URL (rtsp://…)이 포함됩니다.기본 포트 554번은 UDP, TCP 둘 다에 사용됩니다. DESCRIBE에 대한 응답 메시지에는 요청한 것에 대한 설명도 포함되는데, 대개 Session Description Protocol (SDP) 형태를 갖추고 있습니다.</p></li><li><p>SETUP<br>SETUP 요청은 단일 미디어 스트림이 전송되어야 하는지 규정합니다. 이 요청은 PLAY 요청 하기 전에 마쳐야 합니다. 그리고 요청할 때 미디어 스트림 URL과 전송점을 포함해야 합니다. 전송점에는 RTP 데이터(오디오/비디오), RTCP 데이터(메타 정보)를 전송받기 위한 포트 번호도 포함됩니다.</p></li><li><p>PLAY<br>PLAY 요청은 하나 또는 모든 미디어 스트림을 재생시킵니다. PLAY 명령은 다중 요청이 가능합니다. 모든 미디어 스트림 재생을 위해서는 URL 집합체가 요청에 포함되어야 합니다. 재생 범위를 구체적으로 지정할 수도 있습니다. 만약 재생 범위를 지정하지 않으면, 미디어 처음부터 끝까지 재생하게됩니다. 또, 일시 정지 상태라면 일시 정지된 위치부터 재생됩니다.</p></li><li><p>PAUSE<br>PLAY 요청은 하나 또는 모든 스트림을 재생시킵니다. PLAY 명령은 다중 요청이 가능합니다. 모든 미디어 스트림 재생을 위해서는 URL 집합체가 요청에 포함되어야 합니다. 일시 정지할때 범위를 구체적으로 지정할 수도 있습니다.</p></li><li><p>RECORD<br>RECORD 요청은 녹화를 위한 명령어입니다.</p></li><li><p>TEARDOWN<br>TEARDOWN 요청은 세션을 종료하기 위한 명령어이고, 모든 미디어 스트림의 재생을 중단하고 서버에 있는 관련 데이터에 걸린 모든 세션도 해제합니다.</p></li></ul><h3 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h3><p><a href="https://slidesplayer.org/slide/15231455/" target="_blank" rel="noopener">https://slidesplayer.org/slide/15231455/</a><br><a href="https://brunch.co.kr/@linecard/154" target="_blank" rel="noopener">https://brunch.co.kr/@linecard/154</a><br><a href="https://copycode.tistory.com/104" target="_blank" rel="noopener">https://copycode.tistory.com/104</a><br><a href="https://looksense.tistory.com/180" target="_blank" rel="noopener">https://looksense.tistory.com/180</a><br><a href="http://www.titorus.com/?p=54" target="_blank" rel="noopener">http://www.titorus.com/?p=54</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;RTP-Real-Time-Transport-Protocol&quot;&gt;&lt;a href=&quot;#RTP-Real-Time-Transport-Protocol&quot; class=&quot;headerlink&quot; title=&quot;- RTP(Real Time Transport Protocol)&quot;&gt;&lt;/a&gt;- RTP(Real Time Transport Protocol)&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;Viedio/Audio &lt;strong&gt;데이터&lt;/strong&gt; 전송을 위한 프로토콜.&lt;/li&gt;
&lt;li&gt;RTP는 불규칙하게 수신되는 데이터의 순서를 정렬하기 위해 타임스탬프 방식을 사용&lt;/li&gt;
&lt;li&gt;프로토콜 내부에 위치하는 버퍼의 크기를 각 응용 프로그램마다 별도로 관리하기가 용이함.&lt;/li&gt;
&lt;li&gt;RTP는 유니 캐스팅뿐만 아니라 멀티캐스팅도 지원한다.&lt;/li&gt;
&lt;li&gt;서버에서 클라이언트로 단방향 전송.&lt;/li&gt;
&lt;li&gt;해더 마다 코덱이 들어가므로 네트워크 상황에 따라 코덱을 바꿀수 있음.&lt;/li&gt;
&lt;li&gt;UDP/IP 패킷 전송.&lt;/li&gt;
&lt;li&gt;실시간 환경에서는 수신 프로세스에 도착하는 전송 간격이 그대로 유지 되는 것이 중요하므로 버퍼라는 도구를 사용&lt;/li&gt;
&lt;li&gt;가변적인 간격으로 도착하는 데이터를 즉시 수신사에 보내지 않고 지연 버퍼를 통해 다시 일정한 간격으로 보정을 하는 역할을 수행한다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;:/ed0ad510d9b14fff8bd168b8d9d0f260&quot; alt=&quot;스크린샷_2018-07-15_오후_9.36.52.png&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;RTP-릴레이-기능&quot;&gt;&lt;a href=&quot;#RTP-릴레이-기능&quot; class=&quot;headerlink&quot; title=&quot;RTP 릴레이 기능&quot;&gt;&lt;/a&gt;RTP 릴레이 기능&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;고속 네트워크와 저속 네트워크 모두를 만족시키기 위해 데이터 중계 호스트를 규정&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&quot;믹서-데이터-합성기&quot;&gt;&lt;a href=&quot;#믹서-데이터-합성기&quot; class=&quot;headerlink&quot; title=&quot;믹서(데이터 합성기)&quot;&gt;&lt;/a&gt;믹서(데이터 합성기)&lt;/h5&gt;&lt;ol&gt;
&lt;li&gt;네트워크 대역이 충분하지 않는 경우 개별적으로 데이터를 송신하면 네트워크 대역이 범람하여 부족 현상이 생길 가능성이 있음.&lt;/li&gt;
&lt;li&gt;여러 송신 프로세스의 데이터그램을 적절히 조합하여 새로운 데이터그램을 생성한다.&lt;br&gt;ex) 영상과 음성을 믹싱하여 새로운 동영상을 만드는것&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&quot;트랜슬레이터-속도-변환기&quot;&gt;&lt;a href=&quot;#트랜슬레이터-속도-변환기&quot; class=&quot;headerlink&quot; title=&quot;트랜슬레이터(속도 변환기)&quot;&gt;&lt;/a&gt;트랜슬레이터(속도 변환기)&lt;/h5&gt;&lt;ol&gt;
&lt;li&gt;수신자 환경에 맞게 바꾸어 주는 것을 의미한다.&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&quot;세션-Session&quot;&gt;&lt;a href=&quot;#세션-Session&quot; class=&quot;headerlink&quot; title=&quot;세션(Session)&quot;&gt;&lt;/a&gt;세션(Session)&lt;/h4&gt;
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="미디어" scheme="http://yoursite.com/tags/%EB%AF%B8%EB%94%94%EC%96%B4/"/>
    
  </entry>
  
  <entry>
    <title>smart black box 2</title>
    <link href="http://yoursite.com/2021/10/08/dev-smartBBox/"/>
    <id>http://yoursite.com/2021/10/08/dev-smartBBox/</id>
    <published>2021-10-08T07:07:19.000Z</published>
    <updated>2023-06-10T03:41:13.259Z</updated>
    
    <content type="html"><![CDATA[<h1 id="개요"><a href="#개요" class="headerlink" title="개요"></a>개요</h1>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;개요&quot;&gt;&lt;a href=&quot;#개요&quot; class=&quot;headerlink&quot; title=&quot;개요&quot;&gt;&lt;/a&gt;개요&lt;/h1&gt;
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="yolov5" scheme="http://yoursite.com/tags/yolov5/"/>
    
  </entry>
  
  <entry>
    <title>고가용인프라</title>
    <link href="http://yoursite.com/2020/09/24/dev-idc-infra/"/>
    <id>http://yoursite.com/2020/09/24/dev-idc-infra/</id>
    <published>2020-09-24T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.986Z</updated>
    
    <content type="html"><![CDATA[<h2 id="서버-환경"><a href="#서버-환경" class="headerlink" title="서버 환경"></a>서버 환경</h2><p>1.Web(2EA), DB(4EA), HAProxy(1EA), Backup(1EA)<br>2.CentOS 6.10, Apache : 2.4, PHP : 7.3 MariaDB : 10.3</p><h2 id="서버-구성도"><a href="#서버-구성도" class="headerlink" title="서버 구성도"></a>서버 구성도</h2><p><img src="/images/infra.png" alt=""></p><a id="more"></a> <ol><li><p>zenius 모니터링.</p></li><li><p>HAProxy(디비 로드밸런싱)</p><ul><li><a href="https://findstar.pe.kr/2018/07/27/install-haproxy/" target="_blank" rel="noopener">https://findstar.pe.kr/2018/07/27/install-haproxy/</a></li><li><a href="https://en.wikipedia.org/wiki/HAProxy" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/HAProxy</a></li></ul></li><li><p>갈렐라 클러스터</p><ul><li><a href="http://rastalion.me/archives/760" target="_blank" rel="noopener">http://rastalion.me/archives/760</a></li><li><a href="https://bcho.tistory.com/1062" target="_blank" rel="noopener">https://bcho.tistory.com/1062</a></li></ul></li><li><p>RoseHA</p><ul><li><a href="http://www.ibinfo.co.kr/roseha" target="_blank" rel="noopener">http://www.ibinfo.co.kr/roseha</a></li><li><a href="https://m.blog.naver.com/PostView.nhn?blogId=interikorea1999&amp;logNo=220964505509&amp;proxyReferer=https%3A%2F%2Fwww.google.com%2F" target="_blank" rel="noopener">https://m.blog.naver.com/PostView.nhn?blogId=interikorea1999&amp;logNo=220964505509&amp;proxyReferer=https%3A%2F%2Fwww.google.com%2F</a></li></ul></li><li><p>기존에는 위에 그림처럼 HAProxy 위에  Galera로 운영을 하였다. 하지만 대용량 데이터를 인써트 업데이트 하기 때문에 Galera Replication 는 데이터 정합성을 중시하므로 시스템에 lock이 빈번히 걸려 시스템을 Galera를 제거, RoseHA 로 바꾸었다. 현재 별 문제 없이 잘 돌아감.</p></li><li><p>HAProxy, Galera -&gt; RoseHA 로 변경</p><h2 id="백업-및-복구"><a href="#백업-및-복구" class="headerlink" title="백업 및 복구"></a>백업 및 복구</h2><p>xtraback</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;서버-환경&quot;&gt;&lt;a href=&quot;#서버-환경&quot; class=&quot;headerlink&quot; title=&quot;서버 환경&quot;&gt;&lt;/a&gt;서버 환경&lt;/h2&gt;&lt;p&gt;1.Web(2EA), DB(4EA), HAProxy(1EA), Backup(1EA)&lt;br&gt;2.CentOS 6.10, Apache : 2.4, PHP : 7.3 MariaDB : 10.3&lt;/p&gt;
&lt;h2 id=&quot;서버-구성도&quot;&gt;&lt;a href=&quot;#서버-구성도&quot; class=&quot;headerlink&quot; title=&quot;서버 구성도&quot;&gt;&lt;/a&gt;서버 구성도&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/images/infra.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="infra" scheme="http://yoursite.com/tags/infra/"/>
    
  </entry>
  
  <entry>
    <title>streaming 기술 이해</title>
    <link href="http://yoursite.com/2020/06/24/dev-streaminig/"/>
    <id>http://yoursite.com/2020/06/24/dev-streaminig/</id>
    <published>2020-06-24T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.991Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-Streaming-Service-개요"><a href="#1-Streaming-Service-개요" class="headerlink" title="1. Streaming Service 개요"></a>1. Streaming Service 개요</h3><p>영상 전송 방식은 크게 다운로드 방식 프로그레시브 다운로드 (Prog ressive Download)방식, 스트리밍(Streaming ) 방식으로 구분한다.</p><h4 id="1-1-Streaming-이란"><a href="#1-1-Streaming-이란" class="headerlink" title="1.1 Streaming 이란?"></a>1.1 Streaming 이란?</h4><ul><li>인터넷에서 데이터를 실시간 전송, 구현할 수 있게 하는 기술.</li><li>스트리밍은 ‘흐르다’, ‘흘러내리다’, ‘연속되어 끊이지 않고 흐르다’ 등의 의미로,<br>데이터가 조금씩 연속적으로 흘러나온다는 개념과 연관.<br>즉, 어떤 사운드나 비디오 파일을 하나의 형태가 아닌 여러 개의 파일로 나누어<br>물 흐르듯이(Streaming) 연이어 보내는 것.<a id="more"></a> </li><li>동영상 파일 등은 용량이 크기 때문에 한꺼번에 파일 전체를 보내주기란 힘들다.<br>이를 해결하기 위해서 조금씩 파일의 일부만(실제로 영상이 플레이되는 분량만<br>큼만) 실시간으로 전송해 주는 것이 ‘스트리밍’이다.</li><li>사용자가 접속하고 있는 인터넷 네트워크의 속도에 맞춰 비교적 큰 크기의 스트<br>리밍 파일은 아주 작은 크기의 조각들로 나누어진다. 이 조각들은 각각 뒤의 조<br>각들과 이어질 수 있는 헤더정보를 가지고 전송된다. 구동 프로그램에서는 이<br>조각들을 받으면서 동시에 압축을 풀어 동영상이나 음성으로 재생하게 되는 것.</li><li>인터넷에서 동영상을 다운로드가 아닌 실시간 전송에, 실시간 구현이라는 개념을<br>가능케한 것이 바로 스트리밍 기술이다.</li></ul><h4 id="1-2-Progressive-Download"><a href="#1-2-Progressive-Download" class="headerlink" title="1.2 Progressive Download"></a>1.2 Progressive Download</h4><ul><li>동영상 파일이 서버로부터 클라이언트에 전달될 때 파일 일부가 도착하는 대로<br>먼저 재생하는 방법</li><li>512Kbps의 동영상이라면 적어도 512Kbps의 네트웍 속도가 제공되어야만 동영상이 끊임 없이 제공됩니다.</li></ul><h2 id="Streaming-Service-종류"><a href="#Streaming-Service-종류" class="headerlink" title="Streaming Service 종류"></a>Streaming Service 종류</h2><p>스트리밍 서비스는 크게 영상이나 음성을 받아 서비스하는 라이브 방송과 이미<br>저장된 멀티미디어 데이터를 스트리밍 하는 주문형 서비스로 구성될 수 있다.</p><h3 id="VoD-Streaming"><a href="#VoD-Streaming" class="headerlink" title="VoD Streaming"></a>VoD Streaming</h3><h3 id="Live-Streaming"><a href="#Live-Streaming" class="headerlink" title="Live Streaming"></a>Live Streaming</h3><ul><li>비디오와 오디오를 실시간으로 인코딩해 많은 사용자에게 동시에 제공<h3 id="HTTP-Live-Streaming"><a href="#HTTP-Live-Streaming" class="headerlink" title="HTTP Live Streaming"></a>HTTP Live Streaming</h3></li><li>라이브 스트리밍을 위한 전통적인 프로토콜로인 RTP/RTSP는 도입 비용이 높고<br>방화벽 환경에서 서비스가 원활하게 이루어지지 않는 단점이 있다. 이를 보완하<br>기 위해 <strong>HTTP를 이용해 원활한 스트리밍 서비스가 가능하도록 Apple이 개발</strong><br>HTTP 라이브 스트리밍(HTTP Live Streaming, HLS)은 <strong>가장 대중적인 스트리밍 포맷</strong>으로 간주된다<br><strong>HLS는 전반적인 스트림을 크기가 작은 일련의 HTTP 기반 파일 다운로드로 분리시켜 개개의 다운로드를 통해 잠재적으로 무한한 전송 스트림의 작은 덩어리를 적재시킴으로써 동작한다</strong></li></ul><h2 id="Streaming-서비스-구성-요소"><a href="#Streaming-서비스-구성-요소" class="headerlink" title="Streaming 서비스 구성 요소"></a>Streaming 서비스 구성 요소</h2><ol><li>Server side<ul><li>Streaming Server(Encoding 포함)</li><li>Web Server</li></ul></li><li>Client side<ul><li>Streaming Client</li></ul></li></ol><h2 id="Streaming-서비스-동작-원리"><a href="#Streaming-서비스-동작-원리" class="headerlink" title="Streaming 서비스 동작 원리"></a>Streaming 서비스 동작 원리</h2><p>사용자는 웹서버에 요청하고, 스트리밍 서버는 사용자가 요청한 사항에 대하여<br>멀티미디어 데이터를 보낸다.<br>인코딩 서버는 캠코더나 마이크 등의 장비로부터 받아들이는 아날로그 데이터를<br>압축 기술을 사용하여 디지털 데이터로 바꾸는 기능을 한다.</p><h2 id="Streaming-관련-기술"><a href="#Streaming-관련-기술" class="headerlink" title="Streaming 관련 기술"></a>Streaming 관련 기술</h2><p>멀티미디어 스트리밍 기술을 이루는 세 축은 압축 기술, 네트워크 기술, QoS 기술이다. 이 중 압축기술과 네트워크 기술은 없어서는 안 될 중요한 요소이다.</p><h3 id="데이터-전송-및-제어-프로토콜"><a href="#데이터-전송-및-제어-프로토콜" class="headerlink" title="데이터 전송 및 제어 프로토콜"></a>데이터 전송 및 제어 프로토콜</h3><p>RTP(Real-time Transport Protocol)<br>RTCP(Real-Time Transport Control Protocol)<br>RTSP(Real Time Streaming Protocol)<br>MMS(Microsoft Media Server) - 마이크로소프트 네트워크 스트리밍 프로토콜<br>RTMP(Real Time Messaging Protocol) - 어도비 시스템즈사의 독점 컴퓨터 통신 규약</p><h3 id="codec-데이터-압축"><a href="#codec-데이터-압축" class="headerlink" title="codec(데이터 압축)"></a>codec(데이터 압축)</h3><ul><li>WMV/WMA</li><li>H.264(MPEG-4/AVC)</li><li>MPEG2-TS(Transport Stream)</li></ul><h3 id="library"><a href="#library" class="headerlink" title="library"></a>library</h3><ul><li>libavcodec</li></ul><ol><li>libavcodec은 자유 소프트웨어이자 LGPL 라이선스가 걸린 오픈 소스 라이브러리</li><li>이 코덱은 영상 데이터와 음성 데이터를 인코딩하고 디코딩할 수 있다.</li></ol><h3 id="Streaming-지원-포맷"><a href="#Streaming-지원-포맷" class="headerlink" title="Streaming 지원 포맷"></a>Streaming 지원 포맷</h3><ul><li>Container Format</li></ul><ol><li>다양한 종류의 데이터 및 표준 데이터 압축 방법을 사용하여 압축된 데이터를 저장할 수 있는 파일 형식</li><li>컨테이너 파일은 다양한 종류의 데이터를 확인하고 정리할 수 있다.</li><li>컨테이너 포맷은 여러 스트리밍을 재생 치유하는 데 필요한 동기화 정보와 함께 음성, 동영상, 자막, 장( 챕터 ), 자막, 메타 데이터( 태그 ) 등을 지원한다.</li><li>확장자 : mp4, mov, mpg, mpeg, wmv, wma, swf, asf, ksg, flv, mkv, tp, ts, rm, mts</li></ol><h2 id="Streaming-Server-Client"><a href="#Streaming-Server-Client" class="headerlink" title="Streaming Server/Client"></a>Streaming Server/Client</h2><h3 id="Streaming-Server"><a href="#Streaming-Server" class="headerlink" title="Streaming Server"></a>Streaming Server</h3><ul><li><p>RTP Server<br>RTP로 미디어 패킷들을 클라이언트에게 전송하는 역할을 한다. RTCP를 통해 클<br>라이언트의 수신 대역폭에 따라 전송률을 조정한다.</p></li><li><p>RTSP Server<br>RTSP를 사용해서 사용자와 통신하는 역할을 한다. RTP가 단방향 통신인데 비<br>해, RTSP는 양방향 통신이다. 사용자는 RTSP를 통해 비디오 요청, 스킵, 멈춤과<br>같은 기능을 사용할 수 있다.</p></li><li><p>Media Packetizer<br>오디오나 비디오와 같은 미디어파일을 그 파일의 포맷에 따라 네트워크로 전송<br>할 수 있는 패킷으로 쪼개는 역할을 한다.</p></li><li><p>Packet Builder<br>Media Packetizer에서 쪼갠 미디어 데이터를 RTP 패킷으로 만드는 역할을 한다.</p></li></ul><h3 id="open-source"><a href="#open-source" class="headerlink" title="open source"></a>open source</h3><ol><li>Darwin Streaming Server</li></ol><ul><li>애플의 소스 공개 정책에 따라 윈도우즈와 매킨토시 양쪽을 모두 지원</li><li>소스까지 공개되어 있기 때문에 누구든지 무료로 설치 가능</li><li>동영상, MP3 등의 디지털미디어를 실시간으로 배포하고 라이브 이벤트를 실현시킬 수 있으며, Linux, Solaris, Windows NT/2000 등 가장 대중적인 엔터프라이즈급 플랫폼을 지원</li></ul><ol start="2"><li>FFmpeg</li></ol><ul><li>FFmpeg은 명령어를 직접 입력하는 방식으로 동작하며 여러가지 자유 소프트웨어와 오픈 소스 라이브러리로 구성되어 있다.</li><li>라이브러리 중에는 libavcodec도 들어있으며 또, libavformat 라는 음성/영상 다중화, 역다중화 라이브러리도 있다.</li></ul><h3 id="Streaming-Client"><a href="#Streaming-Client" class="headerlink" title="Streaming Client"></a>Streaming Client</h3><ul><li>GStreamer, Media Player Classic, MPEG4IP, MPlayer, QuickTime</li></ul><h2 id="Streaming-업체-및-기술-동향"><a href="#Streaming-업체-및-기술-동향" class="headerlink" title="Streaming 업체 및 기술 동향"></a>Streaming 업체 및 기술 동향</h2><h3 id="국내-Streaming-개발-업체"><a href="#국내-Streaming-개발-업체" class="headerlink" title="국내 Streaming 개발 업체"></a>국내 Streaming 개발 업체</h3><ul><li>솔루션박스, CDNetworks, 나우콤, 피어링 포털<h3 id="스트리밍-호스팅"><a href="#스트리밍-호스팅" class="headerlink" title="스트리밍 호스팅"></a>스트리밍 호스팅</h3>Gabia, 카페24, Godo, inames</li></ul><h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p><a href="https://linuxism.ustd.ip.or.kr/1267" target="_blank" rel="noopener">https://linuxism.ustd.ip.or.kr/1267</a><br><a href="https://d2.naver.com/helloworld/7122" target="_blank" rel="noopener">https://d2.naver.com/helloworld/7122</a> - HTTP Live Streaming</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1-Streaming-Service-개요&quot;&gt;&lt;a href=&quot;#1-Streaming-Service-개요&quot; class=&quot;headerlink&quot; title=&quot;1. Streaming Service 개요&quot;&gt;&lt;/a&gt;1. Streaming Service 개요&lt;/h3&gt;&lt;p&gt;영상 전송 방식은 크게 다운로드 방식 프로그레시브 다운로드 (Prog ressive Download)방식, 스트리밍(Streaming ) 방식으로 구분한다.&lt;/p&gt;
&lt;h4 id=&quot;1-1-Streaming-이란&quot;&gt;&lt;a href=&quot;#1-1-Streaming-이란&quot; class=&quot;headerlink&quot; title=&quot;1.1 Streaming 이란?&quot;&gt;&lt;/a&gt;1.1 Streaming 이란?&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;인터넷에서 데이터를 실시간 전송, 구현할 수 있게 하는 기술.&lt;/li&gt;
&lt;li&gt;스트리밍은 ‘흐르다’, ‘흘러내리다’, ‘연속되어 끊이지 않고 흐르다’ 등의 의미로,&lt;br&gt;데이터가 조금씩 연속적으로 흘러나온다는 개념과 연관.&lt;br&gt;즉, 어떤 사운드나 비디오 파일을 하나의 형태가 아닌 여러 개의 파일로 나누어&lt;br&gt;물 흐르듯이(Streaming) 연이어 보내는 것.
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="streaming" scheme="http://yoursite.com/tags/streaming/"/>
    
  </entry>
  
  <entry>
    <title>docker</title>
    <link href="http://yoursite.com/2020/04/27/dev-ms-docker/"/>
    <id>http://yoursite.com/2020/04/27/dev-ms-docker/</id>
    <published>2020-04-27T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.988Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0-도커-배경"><a href="#0-도커-배경" class="headerlink" title="0. 도커 배경."></a>0. 도커 배경.</h2><ul><li>수많은 서버 관리(설치, 설정, 프로세스 실행)를 용이하게 합니다.</li><li>DevOps의 등장으로 개발주기가 짧아지면서 배포는 더 자주 이루어지고 마이크로서비스 아키텍쳐가 유행하면서 프로그램은 더 잘게 쪼개어져 관리는 더 복잡해집니다. 새로운 툴은 계속해서 나오고 클라우드의 발전으로 설치해야 할 서버가 수백, 수천대에 이르는 상황에서 도커(Docker) 가 등장하고 서버관리 방식이 완전히 바뀌게 됩니다.<a id="more"></a>  \</li></ul><h2 id="1-도커-개요"><a href="#1-도커-개요" class="headerlink" title="1. 도커 개요."></a>1. 도커 개요.</h2><ul><li>도커는 컨테이너 기반의 오픈소스 가상화 플랫폼입니다.</li><li>컨테이너는 다양한 프로그램, 실행환경을 컨테이너로 추상화하고 동일한 인터페이스를 제공하여 프로그램의 배포 및 관리를 단순하게 해줍니다. 백엔드 프로그램, 데이터베이스 서버, 메시지 큐등 어떤 프로그램도 컨테이너로 추상화할 수 있고 조립PC, AWS, Azure, Google cloud등 어디에서든 실행할 수 있습니다.</li></ul><h2 id="2-도커-구조"><a href="#2-도커-구조" class="headerlink" title="2. 도커 구조"></a>2. 도커 구조</h2><p><img src="/images/vm-vs-docker.png" alt=""></p><ul><li>프로세스를 격리시키기 때문에 가볍고 빠르게 동작합니다. CPU나 메모리는 딱 프로세스가 필요한 만큼만 추가로 사용하고 성능적으로도 거의 손실이 없습니다..</li></ul><p><img src="/images/docker-image.png" alt=""></p><ul><li>이미지는 컨테이너 실행에 필요한 파일과 설정값등을 포함하고 있는 것으로 상태값을 가지지 않고 변하지 않습니다(Immutable). 컨테이너는 이미지를 실행한 상태라고 볼 수 있고 추가되거나 변하는 값은 컨테이너에 저장됩니다.</li><li>같은 이미지에서 여러개의 컨테이너를 생성할 수 있고 컨테이너의 상태가 바뀌거나 컨테이너가 삭제되더라도 이미지는 변하지 않고 그대로 남아있습니다.</li><li>ubuntu이미지는 ubuntu를 실행하기 위한 모든 파일을 가지고 있고 MySQL이미지는 debian을 기반으로 MySQL을 실행하는데 필요한 파일과 실행 명령어, 포트 정보등을 가지고 있습니다.</li></ul><h2 id="3-도커-설치-및-설정"><a href="#3-도커-설치-및-설정" class="headerlink" title="3. 도커 설치 및 설정."></a>3. 도커 설치 및 설정.</h2><ul><li><a href="https://luckygg.tistory.com/165" target="_blank" rel="noopener">https://luckygg.tistory.com/165</a></li><li>도커 허브(<a href="https://cloud.docker.com" target="_blank" rel="noopener">https://cloud.docker.com</a>) 가입.</li></ul><h2 id="4-도커-명령어-간단-사용법-우분투-컨테이너로-도커-익히기"><a href="#4-도커-명령어-간단-사용법-우분투-컨테이너로-도커-익히기" class="headerlink" title="4. 도커 명령어 간단 사용법.(우분투 컨테이너로 도커 익히기.)"></a>4. 도커 명령어 간단 사용법.(우분투 컨테이너로 도커 익히기.)</h2><ul><li><p>docker ps -a (등록된 컨테이너 리스트 보기)</p></li><li><p>docker search ubuntu (도커 허브에서 이미지 찾기)</p></li><li><p>docker pull ubuntu:latest (우분투 이미지 다운로드)</p></li><li><p>docker run -i -t -v D:\doc\docker\ubuntu:/home/ –name ubuntu_18.4.3 ubuntu /bin/bash<br>(도커 이미지 컨테이너 등록과 실행. /home 폴더에 D:\cube\doc\docker\ubuntu 해당 디렉토리와 연결함.<br>컨테이너의 Bash 셸로 옵션 -i는 표준 입력(stdin)을 활성화. -t는 TTY 모드(pseudo-TTY)를 사용. -v share volumes .vBash 환경을 쓰려면 -i와 -t 옵션은 기본)</p></li><li><p>docker start  ubuntu_18.4.3(컨테이너 시작)</p></li><li><p>docker attach  ubuntu_18.4.3(터미널 하나만 사용. 또 들어오면 attach(붙음)됨.)</p></li><li><p>docker exec -it  ubuntu_18.4.3 /bin/bash (컨테이너 접속하기)</p></li><li><p>docker inspect ubuntu_18.4.3(컨테이너 세부 정보)</p></li><li><p>docker rm ubuntu_18.4.3(컨테이너 삭제)</p></li><li><p>docker commit -m “메시지” 컨테이너명 이미지명:태그<br>docker를 사용하다 보면 docker container에 특정 프로그램을 설치 한 후 다시 image로 만들고 container를 실행해야 하는 경우가 생긴다.<br>docker container에 특정 프로그램을 설치하고 그대로 사용해도 문제는 없지만 혹여나 설치한 프로그램이 문제가 되어 docker container를 다시 생성해야 할 경우 이전 시점의 docker image가 없다면 복구하기가 어려워 보인다</p></li><li><p>ctrl + p , ctrl + q - 서버 죽이지 않고 나가기.</p></li></ul><h2 id="5-도커파일-명령어"><a href="#5-도커파일-명령어" class="headerlink" title="5. 도커파일 명령어"></a>5. 도커파일 명령어</h2><ul><li><p>FROM: 베이스 이미지를 지정하는 명령어입니다. FROM ubuntu:14.04와 같은 방식으로 사용하고, 버전으로는 latest를 넣을 수도 있습니다. 하지만 가능하면 14.04와 같은 정확한 버전명을 기입하는 것이 좋습니다.</p></li><li><p>RUN: 이미지 상의 리눅스 커맨드를 실행하도록 해주는 명령어입니다.(RUN 명령어는 Dockerfile로부터 이미지를 만들어 낼 때에 실행되는 것입니다.)<br>예를 들어 RUN apt-get -y fortune을 하면 리눅스에서 fortune 라이브러리를 다운로드 받게 됩니다. 이 때 RUN 명령어는 일반적으로 한 번 사용될 때마다 레이어가 하나씩 추가됩니다. 그래서 RUN 명령어를 어떻게 쓰냐에 따라서 이미지의 크기가 달라질 수 있습니다. 그러므로 여러 개의 명령어가 이어지는 경우 다음과 같이 &amp;&amp;를 이용해 하나의 라인에 명령어를 쓰는 것이 좋습니다.<br>RUN apt-get update &amp;&amp; apt-get install -y fortune</p></li><li><p>ADD: build 명령 중간에 호스트의 파일 시스템으로부터 파일을 가져오는 것이다. 말 그대로 이미지에 파일을 더한다(ADD).</p></li><li><p>CMD : 컨테이너 시작 시, 실행될 명령어를 정하는 커맨드이기에 build로 이미지가 만들어지고, 그 이미지로 컨테이너를 run할 때 효력을 갖는다. 컨테이너 시작 시 실행될 명령어이기에 한번만 사용 가능한걸로 알고 있다. </p></li></ul><p>예시를 들어보자. 아래를 입력해 테스트 파일을 생성한다</p><h2 id="6-참조"><a href="#6-참조" class="headerlink" title="6. 참조"></a>6. 참조</h2><p><a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html" target="_blank" rel="noopener">https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html</a><br><a href="https://www.bsidesoft.com/?p=7851" target="_blank" rel="noopener">https://www.bsidesoft.com/?p=7851</a><br><a href="https://willi.am/blog/2016/07/30/docker-for-windows-sharing-host-volumes/" target="_blank" rel="noopener">https://willi.am/blog/2016/07/30/docker-for-windows-sharing-host-volumes/</a></p><h1 id="docker-image"><a href="#docker-image" class="headerlink" title="docker image"></a>docker image</h1><p><a href="https://subicura.com/2017/02/10/docker-guide-for-beginners-create-image-and-deploy.html" target="_blank" rel="noopener">https://subicura.com/2017/02/10/docker-guide-for-beginners-create-image-and-deploy.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 1. ubuntu 설치 (패키지 업데이트 + 만든사람 표시)</span><br><span class="line">FROM       ubuntu:16.04</span><br><span class="line">MAINTAINER subicura@subicura.com</span><br><span class="line">RUN        apt-get -y update</span><br><span class="line"></span><br><span class="line"># 2. ruby 설치</span><br><span class="line">RUN apt-get -y install ruby</span><br><span class="line">RUN gem install bundler</span><br><span class="line"></span><br><span class="line"># 3. 소스 복사</span><br><span class="line">COPY . &#x2F;usr&#x2F;src&#x2F;app</span><br><span class="line"></span><br><span class="line"># 4. Gem 패키지 설치 (실행 디렉토리 설정)</span><br><span class="line">WORKDIR &#x2F;usr&#x2F;src&#x2F;app</span><br><span class="line">RUN     bundle install</span><br><span class="line"></span><br><span class="line"># 5. Sinatra 서버 실행 (Listen 포트 정의)</span><br><span class="line">EXPOSE 4567</span><br><span class="line">CMD    bundle exec ruby app.rb -o 0.0.0.0</span><br></pre></td></tr></table></figure><p>docker build -t app .</p><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker compose"></a>docker compose</h2><p>일반적으로 DOCKER를 사용하여 컨테이너를 띄우면 포트 설정이나 볼륨 설정 등을 아래와 같이 할 수 있다.<br>docker run –name sang12-maria -e MYSQL_ROOT_PASSWORD=mypw -d mariadb:latest  -p 3306:3306<br>관리하는 컨테이너가 하나이거나 올려야 하는 서비스가 한 종류라면 위와 같이 사용해도 무방할 것이다. 하지만 올려야 하는 컨테이너가 다수이고 서비스도 많다면 일일이 위처럼 명령어를 이용해서 사용하기엔 매우 불편할 것이다. 그래서 Docker Compose가 나온 듯 하다.</p><p>DOCKER-COMPOSE를 사용하면 아래와 같이 내가 사용하는 서비스를 docker-compose.yml에 저장하여 이용할 수 있다. docker-compose.yml을 작성하는 문법은 version에 따라 다르니, version에 맞는 문법을 사용해야 한다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3&#39;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: postgres</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;docker&#x2F;data:&#x2F;var&#x2F;lib&#x2F;postgresql&#x2F;data</span><br><span class="line">    environment:</span><br><span class="line">      - POSTGRES_DB&#x3D;sampledb</span><br><span class="line">      - POSTGRES_USER&#x3D;sampleuser</span><br><span class="line">      - POSTGRES_PASSWORD&#x3D;samplesecret</span><br><span class="line">      - POSTGRES_INITDB_ARGS&#x3D;--encoding&#x3D;UTF-8</span><br><span class="line"></span><br><span class="line">  django:</span><br><span class="line">    build:</span><br><span class="line">      context: .</span><br><span class="line">      dockerfile: .&#x2F;compose&#x2F;django&#x2F;Dockerfile-dev</span><br><span class="line">    environment:</span><br><span class="line">      - DJANGO_DEBUG&#x3D;True</span><br><span class="line">      - DJANGO_DB_HOST&#x3D;db</span><br><span class="line">      - DJANGO_DB_PORT&#x3D;5432</span><br><span class="line">      - DJANGO_DB_NAME&#x3D;sampledb</span><br><span class="line">      - DJANGO_DB_USERNAME&#x3D;sampleuser</span><br><span class="line">      - DJANGO_DB_PASSWORD&#x3D;samplesecret</span><br><span class="line">      - DJANGO_SECRET_KEY&#x3D;dev_secret_key</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8000:8000&quot;</span><br><span class="line">    command: </span><br><span class="line">      - python manage.py runserver 0:8000</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;:&#x2F;app&#x2F;</span><br></pre></td></tr></table></figure><h2 id="도커-컴포즈의-주요-명령어"><a href="#도커-컴포즈의-주요-명령어" class="headerlink" title="도커 컴포즈의 주요 명령어"></a>도커 컴포즈의 주요 명령어</h2><ul><li>docker-compose –version<br>버전 확인</li><li>docker-compose up -d</li></ul><p>docker-compose.yml 파일의 내용에 따라 이미지를 빌드하고 서비스를 실행합니다. 자세한 진행 과정은 다음과 같습니다.</p><ol><li>서비스를 띄울 네트워크 설정</li><li>필요한 볼륨 생성(혹은 이미 존재하는 볼륨과 연결)</li><li>필요한 이미지 풀(pull)</li><li>필요한 이미지 빌드(build)</li><li>서비스 의존성에 따라 서비스 실행</li></ol><ul><li>docker-compose ps<br>현재 환경에서 실행 중인 각 서비스의 상태를 보여줍니다.</li></ul><h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><p><a href="http://sang12.co.kr/127/CENTOS-%EB%A6%AC%EB%88%85%EC%8A%A4-DOCKER-COMPOSE-%EC%84%A4%EC%B9%98;jsessionid=260D2ACF81D01681912DA629760B5646" target="_blank" rel="noopener">http://sang12.co.kr/127/CENTOS-%EB%A6%AC%EB%88%85%EC%8A%A4-DOCKER-COMPOSE-%EC%84%A4%EC%B9%98;jsessionid=260D2ACF81D01681912DA629760B5646</a><br><a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose" target="_blank" rel="noopener">https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose</a><br><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener">https://docs.docker.com/compose/compose-file/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0-도커-배경&quot;&gt;&lt;a href=&quot;#0-도커-배경&quot; class=&quot;headerlink&quot; title=&quot;0. 도커 배경.&quot;&gt;&lt;/a&gt;0. 도커 배경.&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;수많은 서버 관리(설치, 설정, 프로세스 실행)를 용이하게 합니다.&lt;/li&gt;
&lt;li&gt;DevOps의 등장으로 개발주기가 짧아지면서 배포는 더 자주 이루어지고 마이크로서비스 아키텍쳐가 유행하면서 프로그램은 더 잘게 쪼개어져 관리는 더 복잡해집니다. 새로운 툴은 계속해서 나오고 클라우드의 발전으로 설치해야 할 서버가 수백, 수천대에 이르는 상황에서 도커(Docker) 가 등장하고 서버관리 방식이 완전히 바뀌게 됩니다.
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="microservice" scheme="http://yoursite.com/tags/microservice/"/>
    
  </entry>
  
  <entry>
    <title>consul</title>
    <link href="http://yoursite.com/2020/04/14/dev-ms-consul/"/>
    <id>http://yoursite.com/2020/04/14/dev-ms-consul/</id>
    <published>2020-04-14T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.988Z</updated>
    
    <content type="html"><![CDATA[<h3 id="사이드카-프록시-로드-밸런서는-Envoy-NGINX-HAProxy-Linkerd입니다"><a href="#사이드카-프록시-로드-밸런서는-Envoy-NGINX-HAProxy-Linkerd입니다" class="headerlink" title="- 사이드카 프록시 로드 밸런서는 Envoy, NGINX, HAProxy, Linkerd입니다."></a>- 사이드카 프록시 로드 밸런서는 Envoy, NGINX, HAProxy, Linkerd입니다.</h3><ul><li>nginx<br><a href="https://learn.hashicorp.com/nomad/load-balancing/nginx" target="_blank" rel="noopener">https://learn.hashicorp.com/nomad/load-balancing/nginx</a></li><li>Envoy<br><a href="https://bcho.tistory.com/1297?category=731548" target="_blank" rel="noopener">https://bcho.tistory.com/1297?category=731548</a></li></ul><a id="more"></a><h3 id="consul-프록시-설정-방법"><a href="#consul-프록시-설정-방법" class="headerlink" title="- consul 프록시 설정 방법"></a>- consul 프록시 설정 방법</h3><ol><li><p>서비스 띄움.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;stringsvc **-listen :8081 **</span><br></pre></td></tr></table></figure></li><li><p>서비스 등록.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ vi consul&#x2F;consul.d&#x2F;stringsvc.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;service&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;stringsvc&quot;,</span><br><span class="line">      &quot;port&quot;: 8081,</span><br><span class="line">      &quot;connect&quot;: &#123; &quot;sidecar_service&quot;: &#123;&#125; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>consul dev로 띄움.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;consul agent -dev -config-dir&#x3D;.&#x2F;consul.d</span><br></pre></td></tr></table></figure></li><li><p>사이드카 등록 및 서비스와 연결.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;consul connect proxy -sidecar-for stringsvc</span><br></pre></td></tr></table></figure></li><li><p>프록시 등록 및 사이드 카와 연결.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;consul connect proxy -service proxy_stringsvc -upstream stringsvc:9191</span><br><span class="line">$ .&#x2F;consul connect proxy -service proxy_stringsvc2 -upstream stringsvc:9192</span><br></pre></td></tr></table></figure></li></ol><p>$ curl -XPOST -d’{“s”:”mytest”}’ <a href="http://localhost:9191/stringsvc/count" target="_blank" rel="noopener">http://localhost:9191/stringsvc/count</a><br>$ curl -XPOST -d’{“s”:”mytest”}’ <a href="http://localhost:9192/stringsvc/count" target="_blank" rel="noopener">http://localhost:9192/stringsvc/count</a><br>$ curl -XPOST -d’{“s”:”mytest”}’ <a href="http://localhost:8081/stringsvc/count" target="_blank" rel="noopener">http://localhost:8081/stringsvc/count</a></p><ul><li>다른 방식</li></ul><ol><li>서비스 등록.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;service&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;stringsvc&quot;,</span><br><span class="line">      &quot;port&quot;: 8081,</span><br><span class="line">      &quot;connect&quot;: &#123;</span><br><span class="line">        &quot;sidecar_service&quot;: &#123;</span><br><span class="line">          &quot;proxy&quot;: &#123;</span><br><span class="line">            &quot;upstreams&quot;: [&#123;</span><br><span class="line">               &quot;destination_name&quot;: &quot;stringsvc&quot;,</span><br><span class="line">               &quot;local_bind_port&quot;: 9191</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">               &quot;destination_name&quot;: &quot;stringsvc&quot;,</span><br><span class="line">               &quot;local_bind_port&quot;: 9192</span><br><span class="line">            &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;consul connect proxy -sidecar-for stringsvc</span><br></pre></td></tr></table></figure></li></ol><ul><li>에러뜸(확인중)</li></ul><h3 id="consul-참조"><a href="#consul-참조" class="headerlink" title="consul 참조"></a>consul 참조</h3><ul><li><a href="https://www.consul.io/docs/connect/registration/service-registration.html" target="_blank" rel="noopener">https://www.consul.io/docs/connect/registration/service-registration.html</a></li><li><a href="https://velog.io/@tedigom/MSA-%EC%A0%9C%EB%8C%80%EB%A1%9C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-4Service-Mesh-f8k317qn1b" target="_blank" rel="noopener">https://velog.io/@tedigom/MSA-%EC%A0%9C%EB%8C%80%EB%A1%9C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-4Service-Mesh-f8k317qn1b</a></li><li><a href="https://www.slideshare.net/SreenivasMakam/service-discovery-using-etcd-consul-and-kubernetes" target="_blank" rel="noopener">https://www.slideshare.net/SreenivasMakam/service-discovery-using-etcd-consul-and-kubernetes</a><br></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;사이드카-프록시-로드-밸런서는-Envoy-NGINX-HAProxy-Linkerd입니다&quot;&gt;&lt;a href=&quot;#사이드카-프록시-로드-밸런서는-Envoy-NGINX-HAProxy-Linkerd입니다&quot; class=&quot;headerlink&quot; title=&quot;- 사이드카 프록시 로드 밸런서는 Envoy, NGINX, HAProxy, Linkerd입니다.&quot;&gt;&lt;/a&gt;- 사이드카 프록시 로드 밸런서는 Envoy, NGINX, HAProxy, Linkerd입니다.&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;nginx&lt;br&gt;&lt;a href=&quot;https://learn.hashicorp.com/nomad/load-balancing/nginx&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://learn.hashicorp.com/nomad/load-balancing/nginx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Envoy&lt;br&gt;&lt;a href=&quot;https://bcho.tistory.com/1297?category=731548&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://bcho.tistory.com/1297?category=731548&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="microservice" scheme="http://yoursite.com/tags/microservice/"/>
    
  </entry>
  
  <entry>
    <title>go-kit</title>
    <link href="http://yoursite.com/2020/04/06/dev-ms-gokit/"/>
    <id>http://yoursite.com/2020/04/06/dev-ms-gokit/</id>
    <published>2020-04-06T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.989Z</updated>
    
    <content type="html"><![CDATA[<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul><li><a href="http://gokit.io/examples/" target="_blank" rel="noopener">http://gokit.io/examples/</a> </li><li><a href="https://medium.com/@shijuvar/go-microservices-with-go-kit-introduction-43a757398183" target="_blank" rel="noopener">https://medium.com/@shijuvar/go-microservices-with-go-kit-introduction-43a757398183</a></li><li><a href="https://github.com/go-kit/kit" target="_blank" rel="noopener">https://github.com/go-kit/kit</a></li></ul><a id="more"></a><h1 id="Go-kit-Architecture"><a href="#Go-kit-Architecture" class="headerlink" title="Go kit Architecture"></a>Go kit Architecture</h1><ul><li><p>Transport layer</p><ol><li>HTTP or gRPC, or using a pub/sub systems like NATS</li><li>you can provide multiple transports for a same service</li></ol></li><li><p>Endpoint layer(추상화)</p><ol><li>Each service method in a Go kit service converts to an endpoint to make RPC style communication between servers and clients</li><li>Each endpoint exposes the service method to outside world using Transport layer by using concrete transports like HTTP or gRPC</li></ol></li><li><p>Service layer</p><ol><li>The business logic</li><li>Go kit service can be exposed by using multiple transports.</li></ol></li><li><p>Service layer</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">type StringService interface &#123;</span><br><span class="line">Uppercase(string) (string, error)</span><br><span class="line">Count(string) int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type stringService struct&#123;&#125;</span><br><span class="line"></span><br><span class="line">func (stringService) Uppercase(s string) (string, error) &#123;</span><br><span class="line">if s &#x3D;&#x3D; &quot;&quot; &#123;</span><br><span class="line">return &quot;&quot;, ErrEmpty</span><br><span class="line">&#125;</span><br><span class="line">return strings.ToUpper(s), nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Endpoint layer<br>1.controller 역할(request, service 호출, response)<br>2.type Endpoint func(ctx context.Context, request interface{}) (response interface{}, err error)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func makeUppercaseEndpoint(svc StringService) endpoint.Endpoint &#123;</span><br><span class="line">return func(ctx context.Context, request interface&#123;&#125;) (interface&#123;&#125;, error) &#123;</span><br><span class="line">  req :&#x3D; request.(uppercaseRequest)</span><br><span class="line">  v, err :&#x3D; svc.Uppercase(req.S)</span><br><span class="line">  if err !&#x3D; nil &#123;</span><br><span class="line">    return uppercaseResponse&#123;v, err.Error()&#125;, nil</span><br><span class="line">  &#125;</span><br><span class="line">  return uppercaseResponse&#123;v, &quot;&quot;&#125;, nil</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Transport layer<br>1.어떻해 전달할 것인가.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> uppercaseHandler :&#x3D; httptransport.NewServer(</span><br><span class="line">makeUppercaseEndpoint(svc),</span><br><span class="line">decodeUppercaseRequest,</span><br><span class="line">encodeResponse,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">http.Handle(&quot;&#x2F;uppercase&quot;, uppercaseHandler)</span><br></pre></td></tr></table></figure></li><li><p>미들웨어</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">type logmw struct &#123;</span><br><span class="line">logger log.Logger</span><br><span class="line">StringService</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (mw logmw) Uppercase(s string) (output string, err error) &#123;</span><br><span class="line">defer func(begin time.Time) &#123;</span><br><span class="line">_ &#x3D; mw.logger.Log(</span><br><span class="line">&quot;method&quot;, &quot;uppercase&quot;,</span><br><span class="line">&quot;input&quot;, s,</span><br><span class="line">&quot;output&quot;, output,</span><br><span class="line">&quot;err&quot;, err,</span><br><span class="line">&quot;took&quot;, time.Since(begin),</span><br><span class="line">)</span><br><span class="line">&#125;(time.Now())</span><br><span class="line"></span><br><span class="line">output, err &#x3D; mw.StringService.Uppercase(s)</span><br><span class="line">return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-apigateway"><a href="#2-apigateway" class="headerlink" title="2. apigateway"></a>2. apigateway</h2><h3 id="1-Starting-Addsvc"><a href="#1-Starting-Addsvc" class="headerlink" title="1. Starting Addsvc"></a>1. Starting Addsvc</h3><ul><li>go run addsvc.go -debug.addr :7080 -http-addr :7081 -grpc-addr :7082 -thrift-addr :7083 -jsonrpc-addr :7084</li><li>curl -XPOST -d’{“a”:”7”,”b”:”4”}’ <a href="http://localhost:7081/concat" target="_blank" rel="noopener">http://localhost:7081/concat</a> {“v”:”74”}</li></ul><h3 id="2-Starting-Stringsvc-stringsvc3-example"><a href="#2-Starting-Stringsvc-stringsvc3-example" class="headerlink" title="2. Starting Stringsvc(stringsvc3 example)"></a>2. Starting Stringsvc(stringsvc3 example)</h3><ul><li>go run *.go -listen :8081</li><li>curl -XPOST -d’{“s”:”mytest”}’ <a href="http://localhost:8081/count" target="_blank" rel="noopener">http://localhost:8081/count</a> {“v”:6}</li></ul><h3 id="3-Starting-Consul"><a href="#3-Starting-Consul" class="headerlink" title="3. Starting Consul"></a>3. Starting Consul</h3><ul><li>First, you need to download Consul for your specific OS/architecture here.<br>(<a href="https://www.consul.io/downloads.html" target="_blank" rel="noopener">https://www.consul.io/downloads.html</a>)</li><li>Next<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir .&#x2F;consul.d</span><br><span class="line">$ echo &#39;&#123;&quot;service&quot;: &#123;&quot;name&quot;: &quot;addsvc&quot;, &quot;tags&quot;: [], &quot;port&quot;: 7082&#125;&#125;&#39; &gt; .&#x2F;consul.d&#x2F;addsvc.json</span><br><span class="line">$ echo &#39;&#123;&quot;service&quot;: &#123;&quot;name&quot;: &quot;stringsvc&quot;, &quot;tags&quot;: [], &quot;port&quot;: 8081&#125;&#125;&#39; &gt; .&#x2F;consul.d&#x2F;stringsvc.json</span><br><span class="line">$ .&#x2F;consul agent -dev -config-dir&#x3D;.&#x2F;consul.d</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-Starting-Api-Gateway"><a href="#4-Starting-Api-Gateway" class="headerlink" title="4. Starting Api Gateway"></a>4. Starting Api Gateway</h3><p>$ go run main.go -consul.addr :8500</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl -XPOST -d&#39;&#123;&quot;a&quot;:&quot;7&quot;,&quot;b&quot;:&quot;4&quot;&#125;&#39; http:&#x2F;&#x2F;localhost:8000&#x2F;addsvc&#x2F;concat</span><br><span class="line">&#123;&quot;v&quot;:&quot;74&quot;&#125;</span><br><span class="line">$ curl -XPOST -d&#39;&#123;&quot;a&quot;:7,&quot;b&quot;:4&#125;&#39; http:&#x2F;&#x2F;localhost:8000&#x2F;addsvc&#x2F;sum</span><br><span class="line">&#123;&quot;v&quot;:11&#125;</span><br><span class="line">$ curl -XPOST -d&#39;&#123;&quot;s&quot;:&quot;mytest&quot;&#125;&#39; http:&#x2F;&#x2F;localhost:8000&#x2F;stringsvc&#x2F;count</span><br><span class="line">&#123;&quot;v&quot;:6&#125;</span><br><span class="line">$ curl -XPOST -d&#39;&#123;&quot;s&quot;:&quot;mytest&quot;&#125;&#39; http:&#x2F;&#x2F;localhost:8000&#x2F;stringsvc&#x2F;uppercase</span><br><span class="line">&#123;&quot;v&quot;:&quot;MYTEST&quot;&#125;</span><br></pre></td></tr></table></figure><ul><li>apigateway 는 consul 서버에 주기적으로 붙어서 서비스 이름으로 서비스 엔드 포인트 정보를 가지고 온다.</li><li>클라이언트 호출시에는 직접 서비스 엔드 포인트에 접속해서 데이터를 가지고 온다.</li><li>소스는 직접 확인.</li></ul><h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p><a href="https://medium.com/@jwenz723/go-kit-api-gateway-4bee401e77a2" target="_blank" rel="noopener">https://medium.com/@jwenz723/go-kit-api-gateway-4bee401e77a2</a></p><h2 id="3-addsvc"><a href="#3-addsvc" class="headerlink" title="3. addsvc"></a>3. addsvc</h2><ul><li>아래와 같이 패키지 되어 있다.</li></ul><h3 id="1-pkg"><a href="#1-pkg" class="headerlink" title="1. pkg"></a>1. pkg</h3><ul><li>addservice(service.go, middleware.go)</li><li>addendpoint(set.go, middleware.go)</li><li>addtransport(grpc.go, http.go, jsonrpc.go, thrift.go)</li></ul><h3 id="2-addsvc-cmd-addsvc-addsvc-go-사용방법"><a href="#2-addsvc-cmd-addsvc-addsvc-go-사용방법" class="headerlink" title="2. addsvc/cmd/addsvc/addsvc.go(사용방법)"></a>2. addsvc/cmd/addsvc/addsvc.go(사용방법)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var (</span><br><span class="line">        service        &#x3D; addservice.New(logger, ints, chars)</span><br><span class="line">        endpoints      &#x3D; addendpoint.New(service, logger, duration, tracer, zipkinTracer)</span><br><span class="line">        httpHandler    &#x3D; addtransport.NewHTTPHandler(endpoints, tracer, zipkinTracer, logger)</span><br><span class="line">        grpcServer     &#x3D; addtransport.NewGRPCServer(endpoints, tracer, zipkinTracer, logger)</span><br><span class="line">        thriftServer   &#x3D; addtransport.NewThriftServer(endpoints)</span><br><span class="line">        jsonrpcHandler &#x3D; addtransport.NewJSONRPCHandler(endpoints, logger)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="3-addsvc-cmd-addsvc-addcli-go-사용방법"><a href="#3-addsvc-cmd-addsvc-addcli-go-사용방법" class="headerlink" title="3. addsvc/cmd/addsvc/addcli.go(사용방법)"></a>3. addsvc/cmd/addsvc/addcli.go(사용방법)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svc, err &#x3D; addtransport.NewHTTPClient(*httpAddr, otTracer, zipkinTracer, log.NewNopLogger())</span><br><span class="line">svc &#x3D; addtransport.NewGRPCClient(conn, otTracer, zipkinTracer, log.NewNopLogger())</span><br></pre></td></tr></table></figure><h2 id="4-profilesvc"><a href="#4-profilesvc" class="headerlink" title="4. profilesvc"></a>4. profilesvc</h2><ul><li>메모리에 저장, 삭제, 조회 함.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> type Service interface &#123;</span><br><span class="line">PostProfile(ctx context.Context, p Profile) error</span><br><span class="line">GetProfile(ctx context.Context, id string) (Profile, error)</span><br><span class="line">PutProfile(ctx context.Context, id string, p Profile) error</span><br><span class="line">PatchProfile(ctx context.Context, id string, p Profile) error</span><br><span class="line">DeleteProfile(ctx context.Context, id string) error</span><br><span class="line">GetAddresses(ctx context.Context, profileID string) ([]Address, error)</span><br><span class="line">GetAddress(ctx context.Context, profileID string, addressID string) (Address, error)</span><br><span class="line">PostAddress(ctx context.Context, profileID string, a Address) error</span><br><span class="line">DeleteAddress(ctx context.Context, profileID string, addressID string) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ go run .&#x2F;cmd&#x2F;profilesvc&#x2F;main.go -http.addr :8080</span><br><span class="line">$ curl -d &#39;&#123;&quot;id&quot;:&quot;1234&quot;,&quot;Name&quot;:&quot;Go Kit&quot;&#125;&#39; -H &quot;Content-Type: application&#x2F;json&quot; -X POST $ http:&#x2F;&#x2F;localhost:8080&#x2F;profiles&#x2F;</span><br><span class="line">$ curl localhost:8080&#x2F;profiles&#x2F;1234</span><br><span class="line">ts&#x3D;2020-04-06T02:30:46.441838639Z caller&#x3D;middlewares.go:36 method&#x3D;GetProfile id&#x3D;1234 took&#x3D;1.354µs err&#x3D;null</span><br><span class="line">&#123;&quot;profile&quot;:&#123;&quot;id&quot;:&quot;1234&quot;,&quot;name&quot;:&quot;Go Kit&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>/cmd/profilesvc/main.go<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">  var (</span><br><span class="line">          httpAddr &#x3D; flag.String(&quot;http.addr&quot;, &quot;:8080&quot;, &quot;HTTP listen address&quot;)</span><br><span class="line">  )</span><br><span class="line">  flag.Parse()</span><br><span class="line"></span><br><span class="line">  var logger log.Logger</span><br><span class="line">  &#123;</span><br><span class="line">          logger &#x3D; log.NewLogfmtLogger(os.Stderr)</span><br><span class="line">          logger &#x3D; log.With(logger, &quot;ts&quot;, log.DefaultTimestampUTC)</span><br><span class="line">          logger &#x3D; log.With(logger, &quot;caller&quot;, log.DefaultCaller)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var s profilesvc.Service</span><br><span class="line">  &#123;</span><br><span class="line">          s &#x3D; profilesvc.NewInmemService()</span><br><span class="line">          s &#x3D; profilesvc.LoggingMiddleware(logger)(s)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var h http.Handler</span><br><span class="line">  &#123;</span><br><span class="line">          h &#x3D; profilesvc.MakeHTTPHandler(s, log.With(logger, &quot;component&quot;, &quot;HTTP&quot;))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  errs :&#x3D; make(chan error)</span><br><span class="line">  go func() &#123;</span><br><span class="line">          c :&#x3D; make(chan os.Signal)</span><br><span class="line">          signal.Notify(c, syscall.SIGINT, syscall.SIGTERM)</span><br><span class="line">          errs &lt;- fmt.Errorf(&quot;%s&quot;, &lt;-c)</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  go func() &#123;</span><br><span class="line">          logger.Log(&quot;transport&quot;, &quot;HTTP&quot;, &quot;addr&quot;, *httpAddr)</span><br><span class="line">          errs &lt;- http.ListenAndServe(*httpAddr, h)</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  logger.Log(&quot;exit&quot;, &lt;-errs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;reference&quot;&gt;&lt;a href=&quot;#reference&quot; class=&quot;headerlink&quot; title=&quot;reference&quot;&gt;&lt;/a&gt;reference&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://gokit.io/examples/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://gokit.io/examples/&lt;/a&gt; &lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/@shijuvar/go-microservices-with-go-kit-introduction-43a757398183&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://medium.com/@shijuvar/go-microservices-with-go-kit-introduction-43a757398183&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/go-kit/kit&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/go-kit/kit&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="microservice" scheme="http://yoursite.com/tags/microservice/"/>
    
  </entry>
  
  <entry>
    <title>117회 기출문제</title>
    <link href="http://yoursite.com/2020/04/04/IMT/"/>
    <id>http://yoursite.com/2020/04/04/IMT/</id>
    <published>2020-04-04T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.985Z</updated>
    
    <content type="html"><![CDATA[<h2 id="전체-문제"><a href="#전체-문제" class="headerlink" title="전체 문제"></a>전체 문제</h2><ul><li><a href="https://drive.google.com/file/d/1EDwMIPl66b2EfhRbGi0Aj9F5TNljsgp7/view" target="_blank" rel="noopener">https://drive.google.com/file/d/1EDwMIPl66b2EfhRbGi0Aj9F5TNljsgp7/view</a></li></ul><h2 id="1-HMAC-Hash-based-Message-Authentication-Code"><a href="#1-HMAC-Hash-based-Message-Authentication-Code" class="headerlink" title="1. HMAC(Hash-based Message Authentication Code)"></a>1. HMAC(Hash-based Message Authentication Code)</h2><ul><li>날짜 : 0404</li><li>레퍼런스 : <a href="https://www.joinc.co.kr/w/man/12/hmac" target="_blank" rel="noopener">https://www.joinc.co.kr/w/man/12/hmac</a></li><li>키워드 : Hash,Shared Key,MAC Algorithm</li><li>답안전략 : 정확한 메커니즘 설명 및 3 단락에서의 차별화 접근<a id="more"></a></li></ul><h3 id="개념"><a href="#개념" class="headerlink" title="개념"></a>개념</h3><ul><li>송신자와 수신자만이 공유하고 있는 Key 와 Message 를 혼합하여 Hash 값을 만드는 방식</li><li>HMAC = Hash(Hash(message + key) + key)</li></ul><h3 id="특징"><a href="#특징" class="headerlink" title="특징"></a>특징</h3><ul><li>메시지의 무결성, 기밀성 보장</li><li>알고리즘: MD5, SHA1</li><li>분류: HMAC-MD5, HMAC-SHA1</li><li>채널을 통해 보낸 메시지가 훼손되었는지 여부를 확인하는데 사용할 수 있음</li><li>MAC 의 특성상 역산이 불가능 하므로, 수신된 메시지와 Hash 값을 다시 계산하여, 계산된 HMAC 과 전송된 HMAC 이 일치하는지를 확인하는 방식</li></ul><h3 id="프로세스"><a href="#프로세스" class="headerlink" title="프로세스"></a>프로세스</h3><ol><li>별도 채널을 이용하여 Sender 와 Receiver 는 해시에 사용할 키(shared key)를 공유.</li><li>해시 알고리즘 선정</li><li>Sender<br>3.1 message = 전화번호 + 유저아이디;<br>3.2 hash = SHA1(message + Shared Key), message 를 보낸다.</li><li>Receiver<br>4.1 Sender에서 보낸 message 를 SHA1(message + Shared Key) 로 해서 Sender 의 해시와<br>Receiver 에서 계산한 해시값이 같은지 확인 후 같으면 인증 그렇지 않으면 assert 된다.</li></ol><h3 id="해킹-공격에-따른-방어-정책"><a href="#해킹-공격에-따른-방어-정책" class="headerlink" title="해킹 공격에 따른 방어 정책."></a>해킹 공격에 따른 방어 정책.</h3><ol><li>다시 보내는 replay 공격에 노출될 수 있으므로 1초에 10번 이상 들어오면 assert 처리함.</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;전체-문제&quot;&gt;&lt;a href=&quot;#전체-문제&quot; class=&quot;headerlink&quot; title=&quot;전체 문제&quot;&gt;&lt;/a&gt;전체 문제&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://drive.google.com/file/d/1EDwMIPl66b2EfhRbGi0Aj9F5TNljsgp7/view&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://drive.google.com/file/d/1EDwMIPl66b2EfhRbGi0Aj9F5TNljsgp7/view&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;1-HMAC-Hash-based-Message-Authentication-Code&quot;&gt;&lt;a href=&quot;#1-HMAC-Hash-based-Message-Authentication-Code&quot; class=&quot;headerlink&quot; title=&quot;1. HMAC(Hash-based Message Authentication Code)&quot;&gt;&lt;/a&gt;1. HMAC(Hash-based Message Authentication Code)&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;날짜 : 0404&lt;/li&gt;
&lt;li&gt;레퍼런스 : &lt;a href=&quot;https://www.joinc.co.kr/w/man/12/hmac&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.joinc.co.kr/w/man/12/hmac&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;키워드 : Hash,Shared Key,MAC Algorithm&lt;/li&gt;
&lt;li&gt;답안전략 : 정확한 메커니즘 설명 및 3 단락에서의 차별화 접근
    
    </summary>
    
    
      <category term="정보 관리 기술사" scheme="http://yoursite.com/categories/%EC%A0%95%EB%B3%B4-%EA%B4%80%EB%A6%AC-%EA%B8%B0%EC%88%A0%EC%82%AC/"/>
    
    
  </entry>
  
  <entry>
    <title>마이크로 서비스 활용</title>
    <link href="http://yoursite.com/2020/03/31/dev-microservice/"/>
    <id>http://yoursite.com/2020/03/31/dev-microservice/</id>
    <published>2020-03-31T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.987Z</updated>
    
    <content type="html"><![CDATA[<h2 id="넷플릭스의-마이크로-서비스-프레임웍-오픈소스-예"><a href="#넷플릭스의-마이크로-서비스-프레임웍-오픈소스-예" class="headerlink" title="넷플릭스의 마이크로 서비스 프레임웍 오픈소스 예"></a>넷플릭스의 마이크로 서비스 프레임웍 오픈소스 예</h2><p><img src="/images/99C3BD4B5BF3A99708.png" alt=""><br> 사용법이 복잡하다는 것이다. Hystrix 하나만을 적용하는데도 많은 노력이 필요한데, 여러개의 프레임웍을 적용하는 것은 여간 어려운 일이 아니다.</p><p>그런데 여기서 스프링 프레임웍이 이런 문제를 풀어내는 기여를 한다. 스프링 프레임웍에 넷플릭스의 마이크로 서비스 오픈 소스 프레임웍을 통합 시켜 버린것이다. (<a href="http://spring.io/projects/spring-cloud-netflix" target="_blank" rel="noopener">http://spring.io/projects/spring-cloud-netflix</a>) </p><p>복잡한 부분을 추상화해서 스프링 프레임웍을 적용하면 손쉽게 넷플릭스의 마이크로 서비스 프레임웍을 사용할 수 있게 해줬는데, 마지막 문제가 남게 된다. 스프링은 자바 개발 프레임웍이다. 즉 자바에만 적용이 가능하다.</p><a id="more"></a> <h2 id="서킷-브레이커"><a href="#서킷-브레이커" class="headerlink" title="서킷 브레이커"></a>서킷 브레이커</h2><p>서킷 브레이커 패턴은 개념적으로 전기 시스템에서의 회로 차단기/누전 차단기와 같다. 일정 수준(임계치) 이상의 전기를 소모하게 되면 누전 차단기가 작동하는 것처럼 호출하고자 하는 다른 서비스에 문제가 지속해서 생길 경우 해당 문제가 설정한 임계치 기준에 다다르면 서킷(Circuit, 회로)이 열려 차단기가 작동하게 된다. </p><ul><li><p>각 서비스간 의존성이 높은 경우 연속적으로 장애가 발생할수 있다. 이런 의존성 문제를 해결하기 위해 fallback을 활용하여 서비스에 오류가 있더라도 사전에 지정된 응답을 전달하거나 전달받아 다른 서비스에 영향을 주지 않도록 한다.</p></li><li><p>서킷 브레이커</p></li></ul><p><img src="/images/993CF6395BF3A99722.png" alt=""></p><h2 id="서비스-매쉬"><a href="#서비스-매쉬" class="headerlink" title="서비스 매쉬"></a>서비스 매쉬</h2><h3 id="프록시"><a href="#프록시" class="headerlink" title="프록시"></a>프록시</h3><p>이러한 마이크로 서비스의 문제를 풀기 위해서 소프트웨어 계층이 아니라 인프라 측면에서 이를 풀기 위한 노력이 서비스 매쉬라는 아키텍쳐 컨셉이다. </p><p>아래와 같이 서비스와 서비스간의 호출이 있을때 이를 직접 서비스들이 호출을 하는 것이 아니라 서비스 마다 프록시를 넣는다.</p><p>이렇게 하면 서비스로 들어오거나 나가는 트래픽을 네트워크 단에서 모두 통제가 가능하게 되고, 트래픽에 대한 통제를 통해서 마이크로 서비스의 여러가지 문제를 해결할 수 있다. </p><p>예를 들어 앞에서 설명한 써킷 브레이커와 같은 경우에는 호출되는 서비스가 응답이 없을때 프록시에서 이 연결을 끊어서 장애가 전파되지 않도록 하면된다. </p><p><img src="/images/997EC8335BF3A99702.png" alt=""></p><h3 id="서비스-매쉬-구조를-구현한-오픈-소스-솔루션인-Istio"><a href="#서비스-매쉬-구조를-구현한-오픈-소스-솔루션인-Istio" class="headerlink" title="서비스 매쉬 구조를 구현한 오픈 소스 솔루션인 Istio"></a>서비스 매쉬 구조를 구현한 오픈 소스 솔루션인 Istio</h3><p><a href="https://layer5.io/landscape" target="_blank" rel="noopener">https://layer5.io/landscape</a></p><p>아키텍쳐<br>먼저 Istio의 구조를 보자</p><p><img src="/images/99D9B3375BF8090D27.png" alt=""></p><h4 id="데이타-플레인"><a href="#데이타-플레인" class="headerlink" title="데이타 플레인"></a>데이타 플레인</h4><p>  각 프록시들로 이루어져서 트래픽을 설정값에 따라 트래픽을 컨트롤 하는 부분을 데이타 플레인(Data Plane)</p><h4 id="컨트롤-플레인"><a href="#컨트롤-플레인" class="headerlink" title="컨트롤 플레인"></a>컨트롤 플레인</h4><ol><li><p>파일럿 (Pilot) - 서비스들의 엔드포인트(EndPoint)들의 주소를 얻을 수 있는 서비스 디스커버리 기능을 제공. 이외도 서비스의 안정성을 제공하기 위해서 서비스간에 호출이 발생할때 재시도(retry), 장애 전파를 막기 위한 써킷 브레이커 (Circuit breaker), Timeout 등의 기능을 제공한다.</p></li><li><p>믹서(Mixer)<br>믹서가 하는 일은 액세스 컨트롤, 정책 통제 그리고 각종 모니터링 지표의 수집이다.<br>예를 들어서 서비스의 총 처리량을 정책으로 지정하여, 그 처리량 이상으로 요청을 못받게 하거나 특정 헤더값이 일치해야 요청을 받을 수 있게 하는 등의 다양한 정책을 정의하고 이를 컨트롤 할 수 있다.<br>또한 서비스의 응답 시간이나 평균 처리량과 같은 다양한 지표를 수집하여 저장하는 역할을 한다. </p></li><li><p>시타델(Citadel)<br>시타델은 보안에 관련된 기능을 담당하는 모듈이다. 서비스를 사용하기 위한 사용자 인증 (Authentication)과 인가 (Authorization)을 담당한다. 또한 Istio는 통신을 TLS(SSL)을 이용하여 암호화할 수 있는데, TLS 암호화나 또는 사용자 인증에 필요한 인증서(Certification)을 관리하는 역할을 한다.  </p></li></ol><h4 id="Istio-설치-및-BookInfo-샘플-애플리케이션-설치"><a href="#Istio-설치-및-BookInfo-샘플-애플리케이션-설치" class="headerlink" title="Istio 설치 및 BookInfo 샘플 애플리케이션 설치"></a>Istio 설치 및 BookInfo 샘플 애플리케이션 설치</h4><p><a href="https://bcho.tistory.com/1297?category=731548" target="_blank" rel="noopener">https://bcho.tistory.com/1297?category=731548</a></p><h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p> <a href="https://bcho.tistory.com/1293?category=731548" target="_blank" rel="noopener">https://bcho.tistory.com/1293?category=731548</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;넷플릭스의-마이크로-서비스-프레임웍-오픈소스-예&quot;&gt;&lt;a href=&quot;#넷플릭스의-마이크로-서비스-프레임웍-오픈소스-예&quot; class=&quot;headerlink&quot; title=&quot;넷플릭스의 마이크로 서비스 프레임웍 오픈소스 예&quot;&gt;&lt;/a&gt;넷플릭스의 마이크로 서비스 프레임웍 오픈소스 예&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/images/99C3BD4B5BF3A99708.png&quot; alt=&quot;&quot;&gt;&lt;br&gt; 사용법이 복잡하다는 것이다. Hystrix 하나만을 적용하는데도 많은 노력이 필요한데, 여러개의 프레임웍을 적용하는 것은 여간 어려운 일이 아니다.&lt;/p&gt;
&lt;p&gt;그런데 여기서 스프링 프레임웍이 이런 문제를 풀어내는 기여를 한다. 스프링 프레임웍에 넷플릭스의 마이크로 서비스 오픈 소스 프레임웍을 통합 시켜 버린것이다. (&lt;a href=&quot;http://spring.io/projects/spring-cloud-netflix&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://spring.io/projects/spring-cloud-netflix&lt;/a&gt;) &lt;/p&gt;
&lt;p&gt;복잡한 부분을 추상화해서 스프링 프레임웍을 적용하면 손쉽게 넷플릭스의 마이크로 서비스 프레임웍을 사용할 수 있게 해줬는데, 마지막 문제가 남게 된다. 스프링은 자바 개발 프레임웍이다. 즉 자바에만 적용이 가능하다.&lt;/p&gt;
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="microservice" scheme="http://yoursite.com/tags/microservice/"/>
    
  </entry>
  
  <entry>
    <title>마이크로 서비스 구조</title>
    <link href="http://yoursite.com/2020/02/24/dev-microservice-struct/"/>
    <id>http://yoursite.com/2020/02/24/dev-microservice-struct/</id>
    <published>2020-02-24T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.987Z</updated>
    
    <content type="html"><![CDATA[<h2 id="개요"><a href="#개요" class="headerlink" title="개요"></a>개요</h2><p>마이크로서비스 아키텍처는 하나의 큰 애플리케이션을 여러 개의 작은 애플리케이션으로 쪼개어 변경과 조합이 가능하도록 만든 아키텍처를 말합니다.<br>REST API의 일반화, 도커(Docker)와 같은 컨테이너 기술, 클라우드 컴퓨팅 환경의 발전 등에 힘입어 마이크로서비스는 좀 더 손쉽게 구현될 수 있게 되었습니다.</p><h2 id="마이크로서비스-아키텍처는-언제-필요한가"><a href="#마이크로서비스-아키텍처는-언제-필요한가" class="headerlink" title="마이크로서비스 아키텍처는 언제 필요한가?"></a>마이크로서비스 아키텍처는 언제 필요한가?</h2><ul><li>애플리케이션의 배포에 한 시간 이상 소요된다.</li><li>단순한 기능 하나를 수정해도 전체 기능에 대한 QA가 필요하다.</li><li>단순한 버그 수정이 더 중대한 버그를 생산하는 일이 많아졌다.</li><li>현재의 애플리케이션을 기능별로 나눈다고 가정했을 때 수십개의 마이크로서비스가 가능하다.<a id="more"></a> <h2 id="모놀리틱-아키텍처-MONOLITHIC-ARCHITECTURE"><a href="#모놀리틱-아키텍처-MONOLITHIC-ARCHITECTURE" class="headerlink" title="모놀리틱 아키텍처 (MONOLITHIC ARCHITECTURE)"></a>모놀리틱 아키텍처 (MONOLITHIC ARCHITECTURE)</h2><img src="/images/1.png" alt=""></li><li>일반적인 서비스 구조<br></li></ul><h2 id="마이크로서비스-아키텍처"><a href="#마이크로서비스-아키텍처" class="headerlink" title="마이크로서비스 아키텍처"></a>마이크로서비스 아키텍처</h2><p><img src="/images/2.png" alt=""></p><ul><li><p>하나의 큰 서비스를 독립적인 역할을 수행하는 작은 단위의 서비스로 분리하여 설계하는 패턴</p></li><li><p>여기에서 말하는 독립적인 역할이란 주로, ‘사용자 관리’, ‘주문 관리’, ‘결제 관리’, ‘알림 관리’와 같이 기능적인 요소를 의미</p></li><li><p>서비스별로 별도의 데이터베이스를 사용</p></li><li><p>데이터의 특성과 서비스가 가지는 특수성에 따라 가장 효율적인 데이터베이스를 선택 설계 가능.</p><br>## 마이크로서비스 아키텍처에서의 요청 처리![](/images/6.png)</li><li><p>클라이언트가 모든 마이크로서비스의 호스트명은 물론 end_point를 알고 있어야 한다.</p></li></ul><h3 id="API-GATEWAY"><a href="#API-GATEWAY" class="headerlink" title="API GATEWAY"></a>API GATEWAY</h3><ul><li><p>API Gateway는 시스템의 아키텍처를 내부로 숨기고 외부의 요청에 대한 응답만을 적합한 형태로 응답 함.</p></li><li><p>API Gateway는 이처럼 클라이언트의 요청을 일괄적으로 처리하는 역할 뿐만 아니라, 전체 시스템의 부하를 분산시키는 로드 밸런서의 역할, 동일한 요청에 대한 불필요한 반복작업을 줄일 수 있는 캐싱, 시스템상을 오고가는 요청과 응답에 대한 모니터링 역할도 수행할 수 있습니다.</p></li><li><p>시스템 내부의 아키텍처를 숨길 수 있는(encapsulate) 특성이 API Gateway가 갖는 가장 큰 장점</p></li></ul><h2 id="API-GATEWAY-구현시-고려해야할-점들"><a href="#API-GATEWAY-구현시-고려해야할-점들" class="headerlink" title="API GATEWAY 구현시 고려해야할 점들"></a>API GATEWAY 구현시 고려해야할 점들</h2><ul><li>API Gateway를 비동기(asynchronous)적이고 non-blocking I/O 처리가 가능하도록 구현됨.</li><li>개별 마이크로서비스로 보내는 요청의 선후관계가 존재(자바스크립트의 Promise 등으로 구현 가능)</li><li>분산된 서버의 상태와 여러가지 변수들로 인해서 일부 서비스에 장애가 발생하거나 응답속도가 지연될 가능성이 높아지게 됨.</li><li>특정서비스에 문제가 발생했을 때 API Gateway는 서비스 장애의 종류에 따라 적절한 처리가 가능하도록 설계/구현 되어야 함.</li><li>API Gateway는 모든 요청이 몰리는 지점이기 때문에 동일한 요청에 대하여 중복적으로 마이크로서비스에 요청을 보내는 것 보다 기존의 결과를 캐싱하여 재활용할 수 있도록 설계하는 것이 중요<br></li></ul><h2 id="프로세스간-통신-IPC-inter-process-communication"><a href="#프로세스간-통신-IPC-inter-process-communication" class="headerlink" title="프로세스간 통신 IPC(inter-process communication)"></a>프로세스간 통신 IPC(inter-process communication)</h2><ul><li>동기 메시지 기반 통신<br>동기 요청/응답 기반 : REST, Apache Thrift</li><li>비동기 메시지 기반 통신<br>메시지를 전송하는 표준 프로토콜은 AMQP 와 STOMP가 있습니다. 그리고 오픈소스 메시징 시스템에는 RabbitMQ, Apache Kafka, Apache ActiveMQ, NSQ 등이 있습니다.</li></ul><br><h2 id="메시지-포맷"><a href="#메시지-포맷" class="headerlink" title="메시지 포맷"></a>메시지 포맷</h2><p>통신 방식을 골랐다면 메시지를 어떤 포맷으로 보낼지 골라야 합니다.</p><p>먼저 사람이 읽기 쉽고 이해할 수 있는 XML 과 JSON 이 있습니다. XML 은 XML 스키마로 구조를 정의할 수가 있어서 데이터를 쉽게 검증할 수 있지만 메시지 사이즈가 너무 커집니다. JSON 은 XML 보다 가볍지만 데이터를 검증하기가 쉽지 않았습니다. 그래서 JSON 에서도 XML 처럼 데이터를 검증할 수 있도록 만든 것이 JSON 스키마 입니다.</p><p>이런 텍스트 기반 메시지는 텍스트를 파싱하는데 오버헤드가 생깁니다. 따라서 성능을 위해 바이너리 값으로 전송하는 방법도 있습니다. 많이 쓰이는 것으로는 binary Thrift 나 Protocol Buffers, Apache Avro. 등이 있습니다.</p><h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p><a href="https://futurecreator.github.io/2018/09/14/what-is-microservices-architecture/" target="_blank" rel="noopener">https://futurecreator.github.io/2018/09/14/what-is-microservices-architecture/</a><br><a href="http://guruble.com/%eb%a7%88%ec%9d%b4%ed%81%ac%eb%a1%9c%ec%84%9c%eb%b9%84%ec%8a%a4microservice-%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98-%ea%b7%b8%ea%b2%83%ec%9d%b4-%eb%ad%a3%ec%9d%b4-%ec%a4%91%ed%97%8c%eb%94%94/" target="_blank" rel="noopener">http://guruble.com/%eb%a7%88%ec%9d%b4%ed%81%ac%eb%a1%9c%ec%84%9c%eb%b9%84%ec%8a%a4microservice-%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98-%ea%b7%b8%ea%b2%83%ec%9d%b4-%eb%ad%a3%ec%9d%b4-%ec%a4%91%ed%97%8c%eb%94%94/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;개요&quot;&gt;&lt;a href=&quot;#개요&quot; class=&quot;headerlink&quot; title=&quot;개요&quot;&gt;&lt;/a&gt;개요&lt;/h2&gt;&lt;p&gt;마이크로서비스 아키텍처는 하나의 큰 애플리케이션을 여러 개의 작은 애플리케이션으로 쪼개어 변경과 조합이 가능하도록 만든 아키텍처를 말합니다.&lt;br&gt;REST API의 일반화, 도커(Docker)와 같은 컨테이너 기술, 클라우드 컴퓨팅 환경의 발전 등에 힘입어 마이크로서비스는 좀 더 손쉽게 구현될 수 있게 되었습니다.&lt;/p&gt;
&lt;h2 id=&quot;마이크로서비스-아키텍처는-언제-필요한가&quot;&gt;&lt;a href=&quot;#마이크로서비스-아키텍처는-언제-필요한가&quot; class=&quot;headerlink&quot; title=&quot;마이크로서비스 아키텍처는 언제 필요한가?&quot;&gt;&lt;/a&gt;마이크로서비스 아키텍처는 언제 필요한가?&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;애플리케이션의 배포에 한 시간 이상 소요된다.&lt;/li&gt;
&lt;li&gt;단순한 기능 하나를 수정해도 전체 기능에 대한 QA가 필요하다.&lt;/li&gt;
&lt;li&gt;단순한 버그 수정이 더 중대한 버그를 생산하는 일이 많아졌다.&lt;/li&gt;
&lt;li&gt;현재의 애플리케이션을 기능별로 나눈다고 가정했을 때 수십개의 마이크로서비스가 가능하다.
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="microservice" scheme="http://yoursite.com/tags/microservice/"/>
    
  </entry>
  
  <entry>
    <title>avalon nano miner</title>
    <link href="http://yoursite.com/2020/02/21/project-avalon/"/>
    <id>http://yoursite.com/2020/02/21/project-avalon/</id>
    <published>2020-02-21T05:30:19.000Z</published>
    <updated>2022-09-18T12:42:41.323Z</updated>
    
    <content type="html"><![CDATA[<ol start="0"><li><p>~~ github 소스</p></li><li><p>avalon-nano 크롬 소스를 분석한다.</p></li><li><p>크롬 소스에서 hid SDK(chrome.hid.getDevices)를 nodejs 인 require(“node-hid”) 로<br>컨버팅 한다.(nodejs)</p></li><li><p>avalon-nano USB 디바이스와 접속 후 통신을 한다.(firmware 통신)</p><a id="more"></a><p>3.1 Avalon4_USB_HID_Protocol_Guide 문서 분석.</p><ul><li>Packet 총 길이는 40 Byte</li><li>Head(2)   | Type(1) | Opt(1) | Idx(1) | Cnt(1) | Data(32) | Crc(2)<br>  0<del>3 version(4)<br>  4</del>35 prevhash(32)<br>  36<del>67 merkleRoot(32)<br>  68</del>71 ntime(4)<br>  72<del>75 nbits(4)<br>  76</del>79 nonce(4)</li></ul><p>3.2 P_WORK part 1 : midstat(32) =&gt; sha256(input-&gt;(0,64)) </p><ul><li>version(4) + prevhash(32) + merkleRoot(28) = 64</li></ul><p>3.3 P_WORK part 2: id(6) + data(12) </p><ul><li>32~37 - poolId(1), jqId(1), nonce2(4) -&gt; id(6)</li><li>52~63 - merkleRoot(midstat에 나온 마지막 merkleRoot 4바이트), ntime(4), nbits(4) -&gt; 12<br></li></ul></li><li><p>검증 작업(80 Byte)</p><ol><li>version + prevhash + merkleRoot(32) + ntime + nbits + nonce =&gt; 4바이트 리틀 엔디안으로 바꿔서 더블 해쉬로 만듦.(regen_hash)</li></ol></li></ol><ul><li>node-hid 접속<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">r hid &#x3D; require(&quot;node-hid&quot;);</span><br><span class="line">var connect &#x3D; function() &#123;</span><br><span class="line">dev_con &#x3D; new hid.HID(VENDOR_ID, ID);</span><br><span class="line">detect();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var listen &#x3D; function() &#123;</span><br><span class="line">dev_con.on(&quot;data&quot;, myListener);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function regen_hash(input_str) &#123;</span><br><span class="line">var hex &#x3D; SHA256(hex2littlebinary(input_str), 80);</span><br><span class="line">return SHA256(hex2bigbinary(hex), 32, 0, 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function hex2littlebinary(str)</span><br><span class="line">&#123;</span><br><span class="line">var result &#x3D; new Array();</span><br><span class="line">for(var i &#x3D; 0; i &lt; str.length; i +&#x3D; 8) &#123;</span><br><span class="line">var number &#x3D; 0x00000000;</span><br><span class="line">for(var j &#x3D; 0; j &lt; 4; ++j) &#123;</span><br><span class="line">number &#x3D; safe_add(number, hex_to_byte(str.substring(i + j*2, i + j*2 + 2)) &lt;&lt; (j*8));</span><br><span class="line">&#125;</span><br><span class="line">result.push(number);</span><br><span class="line">&#125;</span><br><span class="line">return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function hex2bigbinary(str)</span><br><span class="line">&#123;</span><br><span class="line">var result &#x3D; new Array();</span><br><span class="line">for(var i &#x3D; 0; i &lt; str.length; i +&#x3D; 8) &#123;</span><br><span class="line">var number &#x3D; 0x00000000;</span><br><span class="line">for(var j &#x3D; 0, k &#x3D; 3; j &lt; 4; ++j, --k) &#123;</span><br><span class="line">number &#x3D; safe_add(number, hex_to_byte(str.substring(i + j*2, i + j*2 + 2)) &lt;&lt; (k*8));</span><br><span class="line">&#125;</span><br><span class="line">result.push(number);</span><br><span class="line">&#125;</span><br><span class="line">return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function hex_to_byte(hex)</span><br><span class="line">&#123;</span><br><span class="line">return( parseInt(hex, 16));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function safe_add (x, y) &#123;</span><br><span class="line">var lsw &#x3D; (x &amp; 0xFFFF) + (y &amp; 0xFFFF);</span><br><span class="line">var msw &#x3D; (x &gt;&gt; 16) + (y &gt;&gt; 16) + (lsw &gt;&gt; 16);</span><br><span class="line">return (msw &lt;&lt; 16) | (lsw &amp; 0xFFFF);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;ol start=&quot;0&quot;&gt;
&lt;li&gt;&lt;p&gt;~~ github 소스&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;avalon-nano 크롬 소스를 분석한다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;크롬 소스에서 hid SDK(chrome.hid.getDevices)를 nodejs 인 require(“node-hid”) 로&lt;br&gt;컨버팅 한다.(nodejs)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;avalon-nano USB 디바이스와 접속 후 통신을 한다.(firmware 통신)&lt;/p&gt;
    
    </summary>
    
    
      <category term="프로젝트" scheme="http://yoursite.com/categories/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/"/>
    
    
      <category term="mining" scheme="http://yoursite.com/tags/mining/"/>
    
      <category term="blockchain" scheme="http://yoursite.com/tags/blockchain/"/>
    
      <category term="pow" scheme="http://yoursite.com/tags/pow/"/>
    
  </entry>
  
  <entry>
    <title>멀티 플레이어 서버 고찰</title>
    <link href="http://yoursite.com/2020/02/06/dev-mutisvr/"/>
    <id>http://yoursite.com/2020/02/06/dev-mutisvr/</id>
    <published>2020-02-06T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.990Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><h2 id="1-생각해야-될점"><a href="#1-생각해야-될점" class="headerlink" title="1. 생각해야 될점"></a>1. 생각해야 될점</h2><ol><li>반응속도 - 우리게임은 초당 몇번의 패킷을 보내야 하는가.(ex 초당 10번을 목표로 동기화(최대RTT - 100ms)) - 모바일 환경에서의 RTT(불규칙)<br><a href="https://aws.amazon.com/ko/blogs/korea/route53-latency-based-routing/" target="_blank" rel="noopener">https://aws.amazon.com/ko/blogs/korea/route53-latency-based-routing/</a></li></ol><a id="more"></a><ol start="2"><li><p>동기화<br>2.1 P2P/CS 사용.<br> 모바일 환경에서 유용한가? </p></li><li><p>보안(실시간이 아닌 검증으로 되는가?) - 유저간의 레이싱 시작할때 맵정보를 받고 레이싱 끝날때 검증을 한다.(게임서버)<br>맵정보에서 없는 좌표가 들어왔을시 또는 1초 동안의 최대 나올수 있는 좌표 범위를 서버에서 계산해서 문제가 있을 경우 블랙유저로 처리한다.</p></li></ol><h2 id="2-망-구조-정리-장단점"><a href="#2-망-구조-정리-장단점" class="headerlink" title="2. 망 구조 정리(장단점)"></a>2. 망 구조 정리(장단점)</h2><ul><li>P2P(보안 약함, 홀펀칭 등 무선 네트워크에서는 변수가 있음.)</li></ul><ol><li>대칭피어방식으로 패킷을 보낸다.</li><li>P2P Lockstep(RTS) 동기화 방식.<br>2.1 명령어를 동시에 내리면 정확히 같은 시점에 모든 피어가 이 명령<br>어를 처리해야 한다.(랜덤 요소가 없어야 한다.) 최대 지연시간 200M 초로 디파인한다.<br>2.2 각 피어(클라이언트)는 저마다 다른 플레임 레이트로 구동되고 접속환경도 품질이 서로 차이가 난다. - 이를 해결하기 위해 턴타이머를 구현해야 한다.<br>2.3 턴 타이머는 명령대기열을 받는 즉시 처리하지 않고 예를들면 한턴(200M)일 경우 두번의 턴이 지난 다음에 처리하므로써 화면에 반영하기까지는 지연시간 까지 합쳐 600M초가 된다.<br>  지연시간에도 불구하고 딱 두턴만 기다려주면 모든 플레이어가 명령을 동시에 처리할수 있다.<br>2.4 최대 지연시간 200M 초를 넘기면 플레이어를 내보내도록 처리한다.<br>2.5 명령어를 메모리에 담기 때문에 리플레이시에 메모리 용량이나 처리부담이 적다.<br>2.6 게임 요소에 난수로 검사할 경우(예를 들면 A인스턴스는 궁수가 보병을 명중시키고, B는 명중을 못시킬 경우) 같은 시드로 같은 횟수로 해야 한다.</li><li>홀펀칭이 안되는 경우 릴레이 서버를 이용한다.</li></ol><ul><li>CS 구조(보안이 필요할 경우, 서버,클라이언트 공수가 큼.)</li></ul><ol><li><p>Pure Client-Server - (LOL)<br>서버와 클라이언트가 동기화를 맞춰준다. (Ex: LOL)<br>클라이언트에서 Input을 주면, 서버에서 게임 로직을 처리한다. 서버가 게임 오브젝트들의 상태를 동기화한다.<br>상태정보가 틀어지기 때문에 클라이언트는 서버에서 보내주는 값들을 자연스럽게 보간 및 예측만 해주면 된다.<br>Peer-to-Peer LockStep처럼 가장 느린 클라이언트에 동기화를 맞춰주는게 아니라 서버에 동기화를 맞춰주기 때문에 다른 클라이언트에 영향을 받지 않는다.<br>당연하지만 서버가 느려질 경우에는 모두가 느려진다.<br>서버의 허락을 받고 명령이 수락되는 방식이기 때문에 해킹에 강한 편이지만, 서버에 허락을 받아야 하기 때문에 반응 속도가 떨어지는 편이다.<br>그리고 Latency가 조금이라도 높아지는 날에는 게임이 지옥으로 변하게 된다. - 온라인에서나 가능할거 같음.</p></li><li><p>Client-Side Prediction (Reconciliation)<br>Client-Server 방식과 비슷하지만, 클라이언트에서 먼저 계산하고, 서버와 오차를 보정해 나가면서 동기화를 맞추는 것이 차이점이다.<br>주로 빠른 반응성이 필요한 FPS(Ex: 콜오브듀티) 게임 등에서 많이 사용되고 있다.<br>서버와 클라이언트 간의 오차를 줄여주는 것이 매우 힘든 작업이다.</p></li><li><p>CS with Lockstep 방식(starcraft)<br>3.1 서버에서 각 피어의 역활을 한다. 그외에 방식은 다 똑같음.<br>3.2 서버에서 게임로직 처리.</p></li></ol><ul><li>혼합 구조.(RTS 방식이 아님)</li></ul><ol><li>클라이언트는 홀펀칭을 시도후에 안되면 게임서버(Relay)에 접속한다. </li><li>홀펀칭이 성공하면 P2P로 1초에 4번 정도 이동패킷을 보내며, 이중에 5~6번마다 한번씩 서버에게 보낸다.(실시간 검증 - 이동 패킷이 허용범위를 넘었을 경우 해킹 유저로 보고 끊는다.)</li><li>서버(게임서버)는 이것을 다른 유저에게 relay한다. 이동패킷을 제외한 패킷의 경우는 P2P로 보낸후 서버에게도 패킷을 보낸다.(평균 2~3초에 한번 보냄)</li><li>패킷을 받는 클라이언트는 P2P든, 서버든 가장 빨리 “보내는 쪽”을 먼저 처리하고 뒤이어 온 패킷은 “무시” 한다.</li><li>서버는 TCP/IP를 사용한다.</li></ol><ul><li>단순 릴레이 구조.(CS 구조)</li></ul><ol><li>클라이언트에서 보내는것을 게임서버는 그대로 Relay를 한다.</li><li>게임 세션 및 검증을 게임서버에서 한다.(실시간이 아닌 검증)</li></ol><ul><li>자료<br>모바일 게임에서의 실시간 멀티플레이에서 P2P와 CS 네트워킹의 비교 <ol><li><a href="http://www.codeinfo.net/bbs/board.php?bo_table=pra_view&amp;wr_id=6" target="_blank" rel="noopener">http://www.codeinfo.net/bbs/board.php?bo_table=pra_view&amp;wr_id=6</a><br>CS 동기화 관련 자료 </li><li><a href="http://yakolla.tistory.com/62" target="_blank" rel="noopener">http://yakolla.tistory.com/62</a><br>P2P RTS 와 CS 관련 자료</li><li><a href="https://pegasuskim.wordpress.com/2015/12/23/%EC%84%9C%EB%B2%84-%EB%8F%99%EA%B8%B0%ED%99%94-%EB%AA%A8%EB%8D%B8/" target="_blank" rel="noopener">https://pegasuskim.wordpress.com/2015/12/23/%EC%84%9C%EB%B2%84-%EB%8F%99%EA%B8%B0%ED%99%94-%EB%AA%A8%EB%8D%B8/</a> </li></ol></li></ul><h2 id="3-그-밖에-참고"><a href="#3-그-밖에-참고" class="headerlink" title="3. 그 밖에 참고"></a>3. 그 밖에 참고</h2><ol><li>EA코리아에서 만든 realracing3은 Time Shifted Multiplayer (비실시간 멀티플레이어) 로 만듦. 뜻은 시간을 옮겨놓은(즉, 서로간의 플레이 시간이 일치하지 않는) 멀티플레이어를 뜻한다<br>TSM 은 사용자들의 주행 데이터를 기반으로 한 인공지능 봇이다. 인터넷이 켜져 있으면 다른 사용자들의 아이디와 프로필 사진, 랩타임을 이용하는 것이고, 꺼져있으면 기본 탑재된 TSM 이 나온다.<br>가끔 TSM 끼리 서로 경쟁하는 모습도 보이곤 하지만 그렇게 적극적인 것은 아니며, 모든 TSM 이 레이싱라인을 따라서 너무나도 질서정연하게 달리기 때문에, TSM 에 실시간 멀티플레이와 같은 변칙적이며 전투적인 플레이를 기대해서는 안 된다</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;h2 id=&quot;1-생각해야-될점&quot;&gt;&lt;a href=&quot;#1-생각해야-될점&quot; class=&quot;headerlink&quot; title=&quot;1. 생각해야 될점&quot;&gt;&lt;/a&gt;1. 생각해야 될점&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;반응속도 - 우리게임은 초당 몇번의 패킷을 보내야 하는가.(ex 초당 10번을 목표로 동기화(최대RTT - 100ms)) - 모바일 환경에서의 RTT(불규칙)&lt;br&gt;&lt;a href=&quot;https://aws.amazon.com/ko/blogs/korea/route53-latency-based-routing/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://aws.amazon.com/ko/blogs/korea/route53-latency-based-routing/&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="game svr" scheme="http://yoursite.com/tags/game-svr/"/>
    
  </entry>
  
  <entry>
    <title>Subversion pre-commit hook</title>
    <link href="http://yoursite.com/2020/02/06/dev-pre%20commit%20hook/"/>
    <id>http://yoursite.com/2020/02/06/dev-pre%20commit%20hook/</id>
    <published>2020-02-06T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.991Z</updated>
    
    <content type="html"><![CDATA[<p>Subversion은 Repository Hook이라는 메커니즘을 가지고 있다.</p><p>pre-commit hook을 사용해, commit하는 내용이나 사용자에 따라, commit할지 말지 여부를 결정하거나, 내용을 수정할 수 있으며, post-commit hook을 사용하면, 모든 commit에 대해 메일을 보내거나 통계를 업데이트할 수 있다.</p><p>pre-commit hook을 등록 할 때는 다음 세 가지를 신경 쓰면 된다.</p><a id="more"></a><p>실행 가능: Subversion repository의 hooks/pre-commit 파일을 액세스하는 프로그램 (e.g. 웹 서버)이 실행 권한을 가질 수 있도록 해야 한다.<br>exit code: exit code에 따라 commit 여부가 결정된다. 0이라면 commit 성공, 1이라면 commit 실패.<br>stderr: 표준 에러로 출력한 메시지가 클라이언트의 에러 메시지로 출력된다.<br>예를 들어, 공백만 있는 commit log와, 특정 author에 의한 commit을 막으려면 다음과 같은 pre-commit hook 스크립트를 사용하면 된다</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">REPOS=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">TXN=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line">SVNLOOK=/usr/bin/svnlook</span><br><span class="line"><span class="variable">$SVNLOOK</span> <span class="built_in">log</span> -t <span class="string">"<span class="variable">$TXN</span>"</span> <span class="string">"<span class="variable">$REPOS</span>"</span> | grep <span class="string">"[^[:space:]]"</span> &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">'EMPTY commit log is NOT ALLOWED'</span> 1&gt;&amp;2</span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="variable">$SVNLOOK</span> author -t <span class="string">"<span class="variable">$TXN</span>"</span> <span class="string">"<span class="variable">$REPOS</span>"</span> | grep -v -e <span class="string">"^public$"</span> &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">'USER public is NOT ALLOWED'</span> 1&gt;&amp;2</span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>이러한 hook들은 shell script로만 한정되는 것은 아니므로, python이나 외부 프로그램을 실행하는 스크립트 등의 방식을 활용할 수 있다.</p><p>Subversion repository에 강제하고 싶은 규칙이 있다면, Subversion의 pre-commit hook을 활용해 보자.</p><p>참조<br><a href="http://blog.lastmind.io/archives/592" target="_blank" rel="noopener">http://blog.lastmind.io/archives/592</a>**</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Subversion은 Repository Hook이라는 메커니즘을 가지고 있다.&lt;/p&gt;
&lt;p&gt;pre-commit hook을 사용해, commit하는 내용이나 사용자에 따라, commit할지 말지 여부를 결정하거나, 내용을 수정할 수 있으며, post-commit hook을 사용하면, 모든 commit에 대해 메일을 보내거나 통계를 업데이트할 수 있다.&lt;/p&gt;
&lt;p&gt;pre-commit hook을 등록 할 때는 다음 세 가지를 신경 쓰면 된다.&lt;/p&gt;
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="svn" scheme="http://yoursite.com/tags/svn/"/>
    
  </entry>
  
  <entry>
    <title>기본 300 문장 암기 - 제시카</title>
    <link href="http://yoursite.com/2020/01/21/eng-daily/"/>
    <id>http://yoursite.com/2020/01/21/eng-daily/</id>
    <published>2020-01-21T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.992Z</updated>
    
    <content type="html"><![CDATA[<ul><li>[0401]<br><a href="https://www.youtube.com/watch?v=ebSETnkZkq0&amp;list=PLMHmzjQsn8r-P1MODIuH7jefDmZ5dNahd" target="_blank" rel="noopener">https://www.youtube.com/watch?v=ebSETnkZkq0&amp;list=PLMHmzjQsn8r-P1MODIuH7jefDmZ5dNahd</a></li></ul><ol><li>i will be rigth back with you</li><li>give me a call</li><li>a piece of cake(쉬워)<a id="more"></a></li><li>any good ideas?</li><li>better than noting(없는거 보다 낫다)</li><li>cat i get a ride?</li><li>cheers</li><li>don’t get too serious -</li><li>don’t be scared</li><li>enjoy your meal</li><li>forget it(됬어 잊어버려~)</li><li>Nice talking to you.</li><li>how have you been?</li><li>i am exhausted.</li><li>i didn’t mean it(의도 하지 않았어)</li><li>i feel the same way.(동의해)</li><li>i’m coming.</li><li>keep in touch(연락 하자)</li><li>let’s try.</li><li>Maybe some other time.(다음에 하자)</li><li>no sweat.(껌이에요) - 스웻</li><li>Ouch.(정전기가 났어)</li><li>Shoot(슛) 이런.</li><li>stop complaining.</li><li>take care(잘있어~)</li><li>that’s the way to go(그래 그렇게 하는거지)</li><li>we are in the same boat.(우리 같은 처지야.)</li><li>what brings you here(무슨일로 오셨어요?)</li><li>who’s there? (거기 누구에요?)</li><li>you stay out of it.(끼어들지마 빠져~) 아러브잇</li></ol><ul><li>[0403]</li></ul><ol><li>are you in line?()</li><li>are you serious?</li><li>have a seat.</li><li>can i get a ride?(태워줄래요)</li><li>catch you later.(담에 또 보자.)</li><li>Did you get it(알아 들었어?)</li><li>Don’t be a chicken(겁쟁이 되지 마.)</li><li>Don’t push me(강요하지마)</li><li>exactly(맞아)</li><li>for what?(그래서 모?)</li><li>give it a try </li><li>go get it(가서 가져와) 승리를 가져와~</li><li>grow up! 철좀 들어라.</li><li>he didn’t show up(나타 나지 않았다.)</li><li>help youself.(많이 드세요)</li><li>how was your trip?(여행 어땠어) /how was your food? /how was your vacation? </li><li>how’s work? how’s family? how’s buisiness?</li><li>i’m getting hungry(슬슬 배고픈데)</li><li>i’m getting tired</li><li>i am impressed (인상적이었어. 좋았어)</li><li>i can’t help it. (어쩔수 없어)</li><li>i got lost(길 잃었다)</li><li>i have no idea(전혀 모르겠다.)</li><li>i’ll get it.(제가 할께요)</li><li>it ‘s out of style(옛날꺼야)</li><li>it takes time.(시간이 좀 걸려)</li><li>it’s your turn(니 차례야)</li><li>let me see(나도 보여줘)</li><li>no way</li><li>shame on you(부끄러운 줄 알어~)</li><li>speak out(크게 말해요)</li></ol><ul><li><a href="https://www.youtube.com/watch?v=qQxcsE42958" target="_blank" rel="noopener">https://www.youtube.com/watch?v=qQxcsE42958</a></li></ul><ol><li>막떠나려는 참이야 - i am about to leave, i am about to tell you</li><li>하는중이야 -  i am on my way, i am on a break</li><li>i’m here to help, i’m here to work , i’am here to see you</li><li>i’m not here to fight, i’m not here to compete.</li><li>i’m not here to say i ‘m sorry</li><li>i’m ready to go, i’m ready to start</li></ol><ul><li>[0404]</li></ul><ol><li>What’s up?</li><li>Nothing much</li><li>You have a wrong number.</li><li>Stop teasing me. 괴롭히지 마.</li><li>Would you like some drink?</li><li>Who cares! - 누가 신경써~ 아무도</li><li>Whar do you mean? </li><li>Watch your language - 말 조심해~</li><li>unbelievable 말도 안 돼</li><li>things will (all) work out 다 잘 될 거야</li><li>there you are 음식을 내주면서 여기 있습니다.</li><li>thanks for the compliment 칭찬 감사합니다</li><li>tell me about it 내말이(동의)</li><li>take your time 천천히 해</li><li>he’s my type 걔 내 스타일이야</li><li>say that again? 뭐 ?, 다시 말해줘</li><li>can you pick me up? 나 좀 데리러 와줘</li><li>make yourself at home (너네 집처럼) 편하게 있어</li><li>let’s get together sometime 다음에 또 보자</li><li>keep going 앞으로 계속 가/하던 일 계속해</li><li>just looking(around) 그냥 둘러보고 있어요</li><li>it’s my fault 내 잘못이야, 내 탓이야</li><li>it’s time for lunch 점심시간이야</li><li>today is chilly, it’s chilly 오늘 쌀쌀하다</li><li>today is hot and humid 오늘 후덥지근하다</li><li>i love it 나 그거 정말 좋아</li><li>i made it 해냈어요 you made it 니가 해났어</li><li>i’ve had enough. i quit 안 해 때려치워,그만할래</li><li>i can handle it 나 할 수 있어</li><li>i can’t afford that 나 여유가 없어(경제적으로)</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;[0401]&lt;br&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=ebSETnkZkq0&amp;amp;list=PLMHmzjQsn8r-P1MODIuH7jefDmZ5dNahd&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.youtube.com/watch?v=ebSETnkZkq0&amp;amp;list=PLMHmzjQsn8r-P1MODIuH7jefDmZ5dNahd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;i will be rigth back with you&lt;/li&gt;
&lt;li&gt;give me a call&lt;/li&gt;
&lt;li&gt;a piece of cake(쉬워)
    
    </summary>
    
    
      <category term="영어" scheme="http://yoursite.com/categories/%EC%98%81%EC%96%B4/"/>
    
    
      <category term="제시카" scheme="http://yoursite.com/tags/%EC%A0%9C%EC%8B%9C%EC%B9%B4/"/>
    
      <category term="300 문장" scheme="http://yoursite.com/tags/300-%EB%AC%B8%EC%9E%A5/"/>
    
  </entry>
  
  <entry>
    <title>BridgeWar</title>
    <link href="http://yoursite.com/2020/01/21/project-bridgewar/"/>
    <id>http://yoursite.com/2020/01/21/project-bridgewar/</id>
    <published>2020-01-21T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.993Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-서버-구성도"><a href="#1-서버-구성도" class="headerlink" title="1. 서버 구성도"></a>1. 서버 구성도</h2><p><img src="/images/404d06966e444c82bfd0082847a86424.png" alt=""></p><a id="more"></a><p><img src="/images/e809b4238e6543858afdec7ce557e30c.png" alt=""></p><h2 id="2-개발-환경"><a href="#2-개발-환경" class="headerlink" title="2. 개발 환경"></a>2. 개발 환경</h2><ul><li>AWS(ec2, Elastic Load balancer, DBS) + Centos 7.0 + apache + CI(php) + mysql + memcached + mcrypt</li></ul><h2 id="3-프로세스"><a href="#3-프로세스" class="headerlink" title="3. 프로세스"></a>3. 프로세스</h2><ol><li>Rest API로 통신을 했으며 json으로 데이터 형식을 표현.</li><li>데이터는 레퍼런스, 유저, 로그, 통합 데이터로 구분.</li><li>분산 디비를 위해 몇십만 이상시에 로그와 유저 디비가 생성하도록 하였고 맴캐쉬에 레퍼런스 데이터를 저장하도록 함.(유저 키로 구분)</li><li>세션마다 키를 주어 암호화 함.(mcrypt)</li><li>클라이언트에서 서버 에러시에 서버에 로그를 남기도록 함.</li><li>매칭 및 랭킹은 통합 디비에서 실시간 매칭과 랭킹으로 구현.</li><li>채팅 서버를 채널별 로드 밸런싱을 하였고 여러개의 프로세스로 분산화 함</li><li>이벤트와 각종 서비스를 셀로 구현<br>8.1 프로세스 죽었을시에 sms 날리고 다시 살리는 셀.(DB, 아파치, 채팅)<br>8.2 매일 통계 데이터 넣는 부분 셀.<br>8.3 health check 셀.<br>8.4 오래된 맬 삭제 셀.<br>8.5 각종 이벤트 셀.<br></li></ol><h2 id="4-미들웨어"><a href="#4-미들웨어" class="headerlink" title="4. 미들웨어"></a>4. 미들웨어</h2><h2 id="5-아마존-서버-구성"><a href="#5-아마존-서버-구성" class="headerlink" title="5. 아마존 서버 구성"></a>5. 아마존 서버 구성</h2><p>DB(2대) db.m4.xlarge - cpu 4, memory 16 SSD 100G<br>WEB(3대) m4.xlarge - cpu 4, memory 16 SSD 80G<br>Elastic Load Balancer</p><h2 id="6-설치-및-설정"><a href="#6-설치-및-설정" class="headerlink" title="6. 설치 및 설정"></a>6. 설치 및 설정</h2><h3 id="memcache-설치"><a href="#memcache-설치" class="headerlink" title="memcache 설치"></a>memcache 설치</h3><ol start="0"><li>맴케쉬는 web01에서만 설치한다.</li><li><a href="http://www.liquidweb.com/kb/how-to-install-memcached-on-centos-7/" target="_blank" rel="noopener">memcache 설치</a><br>yum install zlib-devel<br>1.1 <a href="http://egloos.zum.com/jonnychoe/v/5561398" target="_blank" rel="noopener">PHP memcache 설치</a><pre><code>/home/bridgewar/util/memcache-2.2.6tar -xvf memcache-2.2.6.tgzphpize,  ./configure, make, make install</code></pre></li></ol><h3 id="mcrypt-설치"><a href="#mcrypt-설치" class="headerlink" title="mcrypt 설치"></a>mcrypt 설치</h3><ol><li>yum -y install php-mcrypt</li></ol><h3 id="snappy-설치"><a href="#snappy-설치" class="headerlink" title="snappy 설치"></a>snappy 설치</h3><p>yum install snappy<br>sudo 계정<br>cd php-ext-snappy-master(rpm -qa | grep snappy-1.1.0-3.el7.x86_64)</p><ol><li>cd php-snappy</li><li>phpize</li><li>./configure</li><li>make</li><li>make install</li></ol><h3 id="etc-php-ini-설정"><a href="#etc-php-ini-설정" class="headerlink" title="/etc/php.ini 설정"></a>/etc/php.ini 설정</h3><p>extension=mcrypt.so<br>extension=snappy.so<br>extension=memcache.so<br>timezone 확인.</p><h2 id="7-cron"><a href="#7-cron" class="headerlink" title="7. cron"></a>7. cron</h2><h2 id="8-back-up"><a href="#8-back-up" class="headerlink" title="8. back up"></a>8. back up</h2>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-서버-구성도&quot;&gt;&lt;a href=&quot;#1-서버-구성도&quot; class=&quot;headerlink&quot; title=&quot;1. 서버 구성도&quot;&gt;&lt;/a&gt;1. 서버 구성도&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/images/404d06966e444c82bfd0082847a86424.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="프로젝트" scheme="http://yoursite.com/categories/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/"/>
    
    
      <category term="game svr" scheme="http://yoursite.com/tags/game-svr/"/>
    
  </entry>
  
  <entry>
    <title>monitoring</title>
    <link href="http://yoursite.com/2020/01/21/project-monitoring/"/>
    <id>http://yoursite.com/2020/01/21/project-monitoring/</id>
    <published>2020-01-21T05:30:19.000Z</published>
    <updated>2021-09-02T14:37:32.994Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-개요"><a href="#1-개요" class="headerlink" title="1. 개요"></a>1. 개요</h2><ol><li>여러개의 open source 가 있지만 간단한 내부 모니터 및 알람 툴이다.</li><li>클라이언트(view) : 웹, 아이폰, 안드로이드 앱(react-native 웹앱 구현), <a href="http://116.126.87.167:10000" target="_blank" rel="noopener">view monitoring</a></li><li>서버(admin) : </li><li>서버 환경 : centos6.9, mysql5.5, shell, php7.3</li><li>프로세스<a id="more"></a>  5.1 어드민에서 프로젝트 등록 및 프로젝트 사용자 권한 설정을 한다.<br>5.2 알람 어드민 툴에서 알람 임계치를 설정하여 (관심, 주의, 경고, 위험, 바로조치) sms를 보낼수 있다.<br>5.3 모니터링 하고 싶은 서버에 설치 문서에 따라 설치 및 설정을 한다.<br>5.4 해당 시스템은 크론에 등록되어 매분 체크 된다.<br>5.5 뷰에서 시스템 정보 및 알람 정보를 확인할수 있다.<br>5.6 기본적인 모니터링 셀 구현.</li></ol><hr> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">root_path=<span class="string">"/home/www/common_cron/alarm_admin"</span>;</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -gt 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">" Usage : ./monitor.sh"</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">source</span> <span class="variable">$root_path</span>/alarm_info.ini</span><br><span class="line"></span><br><span class="line">active_ok=`<span class="variable">$mysql_path</span> -h<span class="variable">$alarm_host</span> -u<span class="variable">$alarm_user</span> -p<span class="variable">$alarm_pwd</span> <span class="variable">$alarm_db</span> -e <span class="string">"SELECT active_ok FROM svr_register WHERE pro_name = '<span class="variable">$pro_name</span>' AND svr_name = '<span class="variable">$svr_name</span>'"</span>`</span><br><span class="line">active_ok=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$active_ok</span>"</span> | grep -E <span class="string">'yes|no'</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$active_ok</span> = <span class="string">"no"</span> ] || [ <span class="variable">$active_ok</span> = <span class="string">''</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"pro_name : <span class="variable">$pro_name</span>, svr_name : <span class="variable">$svr_name</span>"</span>;</span><br><span class="line">load_avg=`uptime | awk <span class="string">'&#123;print $(NF-2)" "$(NF-1)" "$NF&#125;'</span>`</span><br><span class="line">cpu=`/usr/bin/mpstat | tail -1 | awk <span class="string">'&#123;print 100 - $12&#125;'</span>`</span><br><span class="line">memory=`free | grep -i mem: | awk <span class="string">'&#123;print $3/$2 * 100&#125;'</span>`</span><br><span class="line">io_wait=`iostat -c|awk <span class="string">'/^ /&#123;print $4&#125;'</span>`</span><br><span class="line">disk=`df -h`</span><br><span class="line">net_id=`netstat -i | awk <span class="string">'&#123;print $1&#125;'</span> | grep -iv lo | grep -iv Iface | grep -iv Kernel`</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$net_id</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">network_rx_error=`netstat -i | grep <span class="variable">$i</span> | awk <span class="string">'&#123;print $5&#125;'</span>`</span><br><span class="line">network_tx_error=`netstat -i | grep <span class="variable">$i</span> | awk <span class="string">'&#123;print $9&#125;'</span>`</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">START=$(date +%s)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$svr_name</span> == <span class="string">"db"</span>* ] || [ <span class="variable">$svr_name</span> == <span class="string">"all"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="comment">#echo "mysql -u$local_user -p'$local_pwd' $local_db &lt; alarm_query.sql"</span></span><br><span class="line">mysql -u<span class="variable">$local_user</span> -p<span class="variable">$local_pwd</span> <span class="variable">$local_db</span> &lt; alarm_query.sql</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">END=$(date +%s)</span><br><span class="line">query_sec=$(( <span class="variable">$END</span> - <span class="variable">$START</span> ))</span><br><span class="line">http_cnt=`netstat -nap | grep :80 | grep ESTABLISHED | wc -l`</span><br><span class="line">ping_sec=`ping -c 1 localhost | grep icmp_seq | awk <span class="string">'&#123;print $8&#125;'</span>`</span><br><span class="line">ping_sec=<span class="variable">$&#123;ping_sec:5:10&#125;</span>;</span><br><span class="line"></span><br><span class="line">db_live_num=`ps -ef | grep mysql | egrep -v grep | wc -l`;</span><br><span class="line">http_live_num=`ps -ef | grep httpd | egrep -v grep | wc -l`;</span><br><span class="line"></span><br><span class="line">db_live_ok=<span class="string">'yes'</span>;</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$db_live_num</span> -lt 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$svr_name</span> == <span class="string">"db"</span>* ] || [ <span class="variable">$svr_name</span> == <span class="string">"all"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">db_live_ok=<span class="string">'no'</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">http_live_ok=<span class="string">'yes'</span>;</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$http_live_num</span> -lt 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$svr_name</span> == <span class="string">"web"</span>* ] || [ <span class="variable">$svr_name</span> == <span class="string">"all"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">http_live_ok=<span class="string">'no'</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$mysql_path</span> -h<span class="variable">$alarm_host</span> -u<span class="variable">$alarm_user</span> -p<span class="variable">$alarm_pwd</span> <span class="variable">$alarm_db</span> -e <span class="string">"INSERT INTO system_log (pro_name, svr_name, load_avg, cpu, memory, io_wait, disk, network_rx_error, network_tx_error, query_sec, http_cnt, ping_sec, db_live_ok, http_live_ok, ip, joindate) VALUES </span></span><br><span class="line"><span class="string">('<span class="variable">$pro_name</span>', '<span class="variable">$svr_name</span>', '<span class="variable">$load_avg</span>', '<span class="variable">$cpu</span>', '<span class="variable">$memory</span>', '<span class="variable">$io_wait</span>', '<span class="variable">$disk</span>', '<span class="variable">$network_rx_error</span>', '<span class="variable">$network_tx_error</span>', '<span class="variable">$query_sec</span>', '<span class="variable">$http_cnt</span>', '<span class="variable">$ping_sec</span>', '<span class="variable">$db_live_ok</span>', '<span class="variable">$http_live_ok</span>', '127.0.0.1', now())"</span></span><br></pre></td></tr></table></figure><h1 id="2-alarm-story-board"><a href="#2-alarm-story-board" class="headerlink" title="2. alarm story board"></a>2. alarm story board</h1><h1 id="3-alarm-admin-alarm-view-정보"><a href="#3-alarm-admin-alarm-view-정보" class="headerlink" title="3. alarm-admin, alarm-view 정보"></a>3. alarm-admin, alarm-view 정보</h1><h1 id="4-설치-및-설정"><a href="#4-설치-및-설정" class="headerlink" title="4. 설치 및 설정"></a>4. 설치 및 설정</h1><p> /home/www/alarm_admin/_cron 모니터링 시스템에 설치 및 설정.<br> alarm_info.ini 수정. - monitor.sh 레퍼</p><ul><li>크론 등록<br>####### alarm<br>##* * * * * /home/www/common_cron/alarm_admin/monitor.sh<br>##* * * * * /usr/bin/php /home/www/common_cron/alarm_admin/work_alarm.php</li></ul><ul><li>sendPush.php - andriod<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">send_notification</span><span class="params">($tokens, $message, $re_num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        $url = <span class="keyword">$this</span>-&gt;url;</span><br><span class="line">        $fields = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'registration_ids'</span> =&gt; $tokens,</span><br><span class="line">                <span class="string">'data'</span> =&gt; $message</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $key = <span class="keyword">$this</span>-&gt;serverKey;</span><br><span class="line">        $headers = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'Authorization:key ='</span> . $key,</span><br><span class="line">                <span class="string">'Content-Type: application/json'</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $ch = curl_init();</span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_POST, <span class="keyword">true</span>);</span><br><span class="line">        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="keyword">true</span>);</span><br><span class="line">        curl_setopt ($ch, CURLOPT_SSL_VERIFYHOST, <span class="number">0</span>);</span><br><span class="line">        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">false</span>);</span><br><span class="line">        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($fields));</span><br><span class="line">        $result = curl_exec($ch);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($result === <span class="keyword">FALSE</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'Curl failed: '</span> . curl_error($ch));</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Result : "</span>.$re_num.<span class="string">" "</span>.$result.<span class="string">"&lt;br&gt;&lt;br&gt;\n\n"</span>;</span><br><span class="line">        <span class="comment">//return $result;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-개요&quot;&gt;&lt;a href=&quot;#1-개요&quot; class=&quot;headerlink&quot; title=&quot;1. 개요&quot;&gt;&lt;/a&gt;1. 개요&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;여러개의 open source 가 있지만 간단한 내부 모니터 및 알람 툴이다.&lt;/li&gt;
&lt;li&gt;클라이언트(view) : 웹, 아이폰, 안드로이드 앱(react-native 웹앱 구현), &lt;a href=&quot;http://116.126.87.167:10000&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;view monitoring&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;서버(admin) : &lt;/li&gt;
&lt;li&gt;서버 환경 : centos6.9, mysql5.5, shell, php7.3&lt;/li&gt;
&lt;li&gt;프로세스
    
    </summary>
    
    
      <category term="프로젝트" scheme="http://yoursite.com/categories/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/"/>
    
    
      <category term="shell" scheme="http://yoursite.com/tags/shell/"/>
    
      <category term="cron" scheme="http://yoursite.com/tags/cron/"/>
    
  </entry>
  
  <entry>
    <title>aws gamelift</title>
    <link href="http://yoursite.com/2020/01/11/dev-gamelift/"/>
    <id>http://yoursite.com/2020/01/11/dev-gamelift/</id>
    <published>2020-01-11T05:30:19.000Z</published>
    <updated>2022-09-18T12:11:01.113Z</updated>
    
    <content type="html"><![CDATA[<h1 id="install-gamelift-SDK-for-linux"><a href="#install-gamelift-SDK-for-linux" class="headerlink" title="install gamelift SDK for linux"></a>install gamelift SDK for linux</h1><ol><li>SDK 다운(<a href="https://ap-northeast-2.console.aws.amazon.com/gamelift/home?region=ap-northeast-2#/" target="_blank" rel="noopener">https://ap-northeast-2.console.aws.amazon.com/gamelift/home?region=ap-northeast-2#/</a>)</li><li>cmake 설치.(yum install cmake)</li><li>해당 폴더(/home/gamelift/gamelift_sdk)에서 cmake CMakeLists.txt(makefile 생성)</li><li>make<a id="more"></a></li><li>cd thirdparty</li><li>cmake CMakeLists.txt</li><li>make(makefile 생성)</li><li>cd /home/gamelift/gamelift_sdk/prefix/lib<br>8.1 libprotobuf.so, libboost_date_time.so, libboost_system.so, libboost_random.so, libprotoc.so (해당 동적 라이브러리가 생성되었는지 확인)</li><li>library PATH 넣어주기.<br>9.1 vi /etc/profile<br>9.2 export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/gamelift/gamelift_sdk/prefix/lib 넣어준다.<br>9.3 source /etc/profile(바로 적용)<br>9.4 echo $LD_LIBRARY_PATH(위에 라이브러리가 추가 되었는지 확인)</li></ol><h1 id="gamelift-사용하는-방법-예제"><a href="#gamelift-사용하는-방법-예제" class="headerlink" title="gamelift 사용하는 방법(예제)"></a>gamelift 사용하는 방법(예제)</h1><ol start="0"><li>문서(GameLift_dist.pdf) </li></ol><p><a href="https://github.com/padhansell/GameLift/blob/master/GameLift_dist.pdf" target="_blank" rel="noopener">https://github.com/padhansell/GameLift/blob/master/GameLift_dist.pdf</a></p><ol><li>다운로드(<a href="https://github.com/zeliard/GameLift" target="_blank" rel="noopener">https://github.com/zeliard/GameLift</a>)</li><li>GameLiftLinuxServer 폴더에서 cmake CMakeLists.txt(makefile 생성)</li><li>make</li></ol><h1 id="자신의-서버-소스에-gamelift를-추가-하는-방법"><a href="#자신의-서버-소스에-gamelift를-추가-하는-방법" class="headerlink" title="자신의 서버 소스에 gamelift를 추가 하는 방법"></a>자신의 서버 소스에 gamelift를 추가 하는 방법</h1><ol><li>소스 컴파일(make, make install)<br>1.1 vi makefile<br>1.2 -L/home/gamelift/gamelift_sdk/prefix/lib  -lsioclient -lboost_date_time -lboost_random -lboost_system -lprotobuf -lpthread (lib 추가)<br>   -I/home/gamelift/gamelift_sdk/prefix/include(include 추가)<br>   GameLiftManager.cpp Log.cpp 추가(gamelift 예제 소스에서 가지고 옴)<br>1.3 make</li></ol><h1 id="아마존-게임리프트-콘솔에-올리는-방법"><a href="#아마존-게임리프트-콘솔에-올리는-방법" class="headerlink" title="아마존 게임리프트 콘솔에 올리는 방법"></a>아마존 게임리프트 콘솔에 올리는 방법</h1><ol><li><p>아마존 게임리프트 콘솔 도움말<br><a href="http://docs.aws.amazon.com/ko_kr/gamelift/latest/developerguide/fleets-creating.html" target="_blank" rel="noopener">http://docs.aws.amazon.com/ko_kr/gamelift/latest/developerguide/fleets-creating.html</a></p></li><li><p>gamelift console 설정(<a href="https://ap-northeast-2.console.aws.amazon.com/gamelift/home?region=ap-northeast-2#/r/fleets/create" target="_blank" rel="noopener">https://ap-northeast-2.console.aws.amazon.com/gamelift/home?region=ap-northeast-2#/r/fleets/create</a>) - 아마존 계정을 만들어야 한다.<br>2.1 aws 액세스 키 생성<br><a href="https://docs.aws.amazon.com/ko_kr/general/latest/gr/managing-aws-access-keys.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/ko_kr/general/latest/gr/managing-aws-access-keys.html</a><br>2.2 게임서버에 session key, secret key 추가.<br>2.2.1 해당 게임서버에서 AWS cli 설치 및 키 추가(<a href="http://pyrasis.com/book/TheArtOfAmazonWebServices/Chapter30/02" target="_blank" rel="noopener">http://pyrasis.com/book/TheArtOfAmazonWebServices/Chapter30/02</a>)<br>2.2.2 해당 서버에 실행 폴더를 AWS cli 통해서 gamelift에 올림.<br>aws gamelift upload-build –name GameLiftLinuxServer5 –build-version 0.0.1 –build-root /home/gamelift/GameLift-master/GameLiftLinuxServer/build –operating-system AMAZON_LINUX –region ap-northeast-2<br>2.2.3 aws gamelift describe-build –build-id (올라 갔는지 확인)<br>2.3 gamelift cosole 접속(직접 들어가서 해야 한다.)</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;install-gamelift-SDK-for-linux&quot;&gt;&lt;a href=&quot;#install-gamelift-SDK-for-linux&quot; class=&quot;headerlink&quot; title=&quot;install gamelift SDK for linux&quot;&gt;&lt;/a&gt;install gamelift SDK for linux&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;SDK 다운(&lt;a href=&quot;https://ap-northeast-2.console.aws.amazon.com/gamelift/home?region=ap-northeast-2#/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://ap-northeast-2.console.aws.amazon.com/gamelift/home?region=ap-northeast-2#/&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;cmake 설치.(yum install cmake)&lt;/li&gt;
&lt;li&gt;해당 폴더(/home/gamelift/gamelift_sdk)에서 cmake CMakeLists.txt(makefile 생성)&lt;/li&gt;
&lt;li&gt;make
    
    </summary>
    
    
      <category term="개발" scheme="http://yoursite.com/categories/%EA%B0%9C%EB%B0%9C/"/>
    
    
      <category term="aws" scheme="http://yoursite.com/tags/aws/"/>
    
      <category term="gamelift" scheme="http://yoursite.com/tags/gamelift/"/>
    
  </entry>
  
</feed>
